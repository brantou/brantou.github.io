<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">










  <meta name="baidu-site-verification" content="2NCO1zLkcL">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|monospace:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="Brantou的日常" type="application/atom+xml">






<meta name="description" content="The best time to plant a tree was 20 years ago. The second best time is now.">
<meta property="og:type" content="website">
<meta property="og:title" content="Brantou的日常">
<meta property="og:url" content="https://brantou.github.io/index.html">
<meta property="og:site_name" content="Brantou的日常">
<meta property="og:description" content="The best time to plant a tree was 20 years ago. The second best time is now.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Brantou的日常">
<meta name="twitter:description" content="The best time to plant a tree was 20 years ago. The second best time is now.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://brantou.github.io/">





  <title>Brantou的日常 - The best time to plant a tree was 20 years ago. The second best time is now.</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-99654689-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a82c2fbb2a57e8b3c01e31a60807a7f6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Brantou的日常</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">二三事</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2018/03/01/regular-expression/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/01/regular-expression/" itemprop="url">正则表达式--探索rx宏</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-01T00:00:00+08:00">
                2018-03-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/技术积累/" itemprop="url" rel="index">
                    <span itemprop="name">技术积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/01/regular-expression/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/03/01/regular-expression/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            

<blockquote>
<p>
原文地址: <a href="http://francismurillo.github.io/2017-03-30-Exploring-Emacs-rx-Macro/" rel="external nofollow noopener noreferrer" target="_blank"> Regular Expression</a>，你喜欢阅读原汁原味的，请阅读原文 。本文只做学习之用。
</p>
</blockquote>

<blockquote>
<p>
Some people, when confronted with a problem, think "I know, I'll use regular expressions."
Now they have two problems. - Jamie Zawinski
</p>
</blockquote>

<p>
最近一直忙于crystal-mode的扩展与维护工作，说实话，真不容易，特别是正则表达式部分，太难阅读。
所以我准备把之前的正则表达式，改造成更可读的 <code>s-expression</code> 形式的，这样的话，维护起来就能简单很多。
<a href="https://www.emacswiki.org/emacs/rx" rel="external nofollow noopener noreferrer" target="_blank">rx</a> 宏更好能很好的满足，我要实现的目标。
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(require &#39;s)  ;; All we need is =s-matches-p=&#10;(require &#39;rx)&#10;&#10;;; Creating a regexp that will match -&#62; &#60;File&#62; [&#60;Line&#62;:&#60;Column] &#60;Suggestion&#62;&#10;(setq this-file-name &#34;regular-expression.org&#34;)&#10;&#10;(s-matches-p&#10; (rx bol&#10;     (eval this-file-name)&#10;     space&#10;     &#34;[&#34; (group (one-or-more digit)) &#34;:&#34; (group (one-or-more digit)) &#34;]&#34;&#10;     space&#10;     (group (zero-or-more anything))&#10;     eol)&#10; &#34;blog.org [17:16] Emacs Lisp, not emacs lisp&#34;)&#10;&#10;;; Produced regexp, I do not want to write or maintain this by hand&#10;&#34;^blog\\.org[[:space:]]\\[\\([[:digit:]]+\\):\\([[:digit:]]+\\)][[:space:]]\\(\\(?:.\\|&#10;\\)*\\)$&#34;</span><br></pre></td></tr></table></figure>
</div>

<p>
虽然不那么简洁，但上面的示例很好的说明了在更高抽象等级下编写正则表达式的优点：更易于理解，写起来更舒适，更容易维护。
同时，使用符号表达式的形式更符合emacs的气质。
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><a id="ID-a19f76ec-2b33-4308-992c-aab479084cb1" name="ID-a19f76ec-2b33-4308-992c-aab479084cb1"></a><span class="section-number-2">1</span> Strings And Quoting</h2>
<div class="outline-text-2" id="text-1">

<pre class="example">
STRING
     matches string STRING literally.

CHAR
     matches character CHAR literally.

‘(eval FORM)’
     evaluate FORM and insert result.  If result is a string,
     ‘regexp-quote’ it.
</pre>

<p>
问题：什么样的正则表达式匹配这个字符串： ASCII表中的标点字符: !"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^<sub>`</sub>{|}
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">;; Escape the double quote here&#10;(setq input &#34;The punctuation characters in the ASCII table are: !\&#34;#$%&#38;&#39;()*+,-./:;&#60;=&#62;?@[\]^_`{|}&#34;)&#10;&#10;(s-matches-p (rx &#34;The punctuation characters in the ASCII table are: !\&#34;#$%&#38;&#39;()*+,-./:;&#60;=&#62;?@[\]^_`{|}&#34;)&#10;&#9;     input) ;; Direct use of strings&#10;&#10;(not (s-matches-p input input)) ;; Does not work because of quoting&#10;(s-matches-p (regexp-quote input) input)&#10;&#10;(s-matches-p (rx (eval input)) input) ;; More rx</span><br></pre></td></tr></table></figure>
</div>

<p>
如果你很清楚(正则表达式)语法字符的话, 可以很容易的看出，这个问题只是由引用或转义语法字符引起的。
函数 <code>regexp-quote</code> 可以转义这些字符，这很简单。 <code>rx</code> 默认转义，可以直接传入字符串。
最后，可通过 <code>eval</code> 语法来使用字符串变量，来完成转义。
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><a id="ID-177d4f1b-9dcd-4436-bf2a-8e0a4d0d62d1" name="ID-177d4f1b-9dcd-4436-bf2a-8e0a4d0d62d1"></a><span class="section-number-2">2</span> Variables And Ranges</h2>
<div class="outline-text-2" id="text-2">

<pre class="example">
‘(any SET ...)’
‘(in SET ...)’
‘(char SET ...)’
     matches any character in SET ....  SET may be a character or string.
     Ranges of characters can be specified as ‘A-Z’ in strings.
     Ranges may also be specified as conses like ‘(?A . ?Z)’.

     SET may also be the name of a character class: ‘digit’,
     ‘control’, ‘hex-digit’, ‘blank’, ‘graph’, ‘print’, ‘alnum’,
     ‘alpha’, ‘ascii’, ‘nonascii’, ‘lower’, ‘punct’, ‘space’, ‘upper’,
     ‘word’, or one of their synonyms.
</pre>

<p>
问题：创建一个正则表达式来匹配 <b>calendar</b> 的所有常见拼写错误，这样就可在文档中找到这个词，
从而不必来考验写作者的拼写能力。 允许在每个元音位置使用a或e。
</p>

<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(s-matches-p (rx &#34;c&#34;&#10;&#9;&#9; (any &#34;a&#34; &#34;e&#34;)&#10;&#9;&#9; &#34;l&#34;&#10;&#9;&#9; (any &#34;a&#34; &#34;e&#34;)&#10;&#9;&#9; &#34;nd&#34;&#10;&#9;&#9; (any &#34;a&#34; &#34;e&#34;)&#10;&#9;&#9; &#34;r&#34;)&#10;&#9;     &#34;celander&#34;)&#10;&#10;(setq misspelling-pattern `(any &#34;a&#34; &#34;e&#34;))&#10;&#10;(s-matches-p (rx &#34;c&#34;&#10;&#9;&#9; (eval misspelling-pattern)&#10;&#9;&#9; &#34;l&#34;&#10;&#9;&#9; (eval misspelling-pattern)&#10;&#9;&#9; &#34;nd&#34;&#10;&#9;&#9; (eval misspelling-pattern)&#10;&#9;&#9; &#34;r&#34;)&#10;&#9;     &#34;calendar&#34;)&#10;&#10;&#34;c[ae]l[ae]nd[ae]r&#34; ;; Generated pattern</span><br></pre></td></tr></table></figure>
</div>

<p>
除了演示一个简单的范围构造，通过熟悉的 <code>eval</code> 使用子模式允许更加模块化地处理这些表达式，这有助于摆脱单一的连接字符串。
</p>

<p>
问题：创建一个正则表达式来匹配单个十六进制字符。
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(s-matches-p (rx (any &#34;a-f&#34; &#34;A-F&#34; &#34;0-9&#34;))&#10;&#9;     &#34;A&#34;)&#10;(s-matches-p (rx (in &#34;a-f&#34; &#34;A-F&#34; &#34;0-9&#34;))&#10;&#9;     &#34;A&#34;) ;; Equivalently&#10;&#10;&#34;[0-9A-Fa-f]&#34; ;; Generated pattern&#10;&#10;&#10;(s-matches-p (rx (char hex-digit))&#10;&#9;     &#34;d&#34;) ;; More rx&#10;(s-matches-p (rx hex-digit)&#10;&#9;     &#34;d&#34;) ;; Equivalently&#10;&#10;&#34;[[:xdigit:]]&#34; ;; Generated pattern</span><br></pre></td></tr></table></figure>
</div>
<p>
最后，范围语法允许熟悉的破折号来表示字符范围。
Rather, the abstraction of special character ranges like [:upper:] or [:xdigit:] is nice to know.
Other useful constructs such as word-start, line-end, and punctuation exist that is worthy to be explored.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><a id="ID-3ff08196-27f2-4beb-97c4-c3bcdfdb72fa" name="ID-3ff08196-27f2-4beb-97c4-c3bcdfdb72fa"></a><span class="section-number-2">3</span> Alternatives And Depth</h2>
<div class="outline-text-2" id="text-3">

<pre class="example">
‘(or SEXP1 SEXP2 ...)’
‘(| SEXP1 SEXP2 ...)’
     matches anything that matches SEXP1 or SEXP2, etc.  If all
     args are strings, use ‘regexp-opt’ to optimize the resulting
     regular expression.

‘(zero-or-one SEXP ...)’
‘(optional SEXP ...)’
‘(opt SEXP ...)’
     matches zero or one occurrences of A.

‘(and SEXP1 SEXP2 ...)’
‘(: SEXP1 SEXP2 ...)’
‘(seq SEXP1 SEXP2 ...)’
‘(sequence SEXP1 SEXP2 ...)’
     matches what SEXP1 matches, followed by what SEXP2 matches, etc.

‘(repeat N SEXP)’
‘(= N SEXP ...)’
     matches N occurrences.
</pre>

<p>
问题：创建一个正则表达式，当重复应用于文本 <code>Mary, Jane, and Sue went to Mary's house</code>
会匹配 <code>Mary</code>, <code>Jane</code>, <code>Sue</code> 然后再次匹配 <code>Mary</code> 。
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(s-match-strings-all&#10; (rx (or &#34;Mary&#34; &#34;Jane&#34; &#34;Sue&#34;))&#10; &#34;Mary, Jane, and Sue went to Mary&#39;s house&#34;)&#10;&#10;;; Output&#10;&#39;((&#34;Mary&#34;) (&#34;Jane&#34;) (&#34;Sue&#34;) (&#34;Mary&#34;))&#10;&#10;;; Generated pattern&#10;&#34;\\(?:Jane\\|Mary\\|Sue\\)&#34;</span><br></pre></td></tr></table></figure>
</div>
<p>
这个简单的问题是使用与范围和类有关的交替构造的示例。 没有什么花哨的东西，但存在使其细微差别的可能性。
</p>

<p>
问题：创建一个匹配0到255的正则表达式。
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(setq range-expression ;; Expression and pattern separated for reuse&#10;      `(or &#34;0&#34;&#10;&#9;   (sequence &#34;1&#34; (optional digit (optional digit)))&#10;&#9;   (sequence &#34;2&#34; (optional&#10;&#9;&#9;&#9;  (or&#10;&#9;&#9;&#9;   (sequence (any &#34;0-4&#34;) (optional digit))&#10;&#9;&#9;&#9;   (sequence &#34;5&#34; (optional (any &#34;0-5&#34;)))&#10;&#9;&#9;&#9;   (sequence (any &#34;6-9&#34;) (optional digit)))))&#10;&#9;   (sequence (any &#34;3-9&#34;) (optional digit))))&#10;&#10;(setq range-pattern (rx (eval range-expression)))&#10;&#10;;; A test for the regular expression&#10;(require &#39;cl)&#10;(cl-every (lambda (number)&#10;&#9;    (s-matches-p range-pattern (number-to-string number)))&#10;&#9;  (number-sequence 0 255))&#10;&#10;;; Generated pattern&#10;&#34;0\\|1\\(?:[[:digit:]][[:digit:]]?\\)?\\|2\\(?:[0-4][[:digit:]]?\\|5[0-5]?\\|[6-9][[:digit:]]?\\)?\\|[3-9][[:digit:]]?&#34;&#10;&#10;;; To use this IP Addresses&#10;(setq ip4-pattern (rx (repeat 3 (sequence (eval range-expression) &#34;.&#34;))&#10;&#9;&#9;      (eval range-expression)))&#10;&#10;;; Testing for permutation might take too long, one is good enough&#10;(s-matches-p ip4-pattern&#10;&#9;     &#34;61.12.234.251&#34;)&#10;&#10;;; Generated pattern&#10;&#34;\\(?:\\(?:0\\|1\\(?:[[:digit:]][[:digit:]]?\\)?\\|2\\(?:[0-4][[:digit:]]?\\|5[0-5]?\\|[6-9][[:digit:]]?\\)?\\|[3-9][[:digit:]]?\\)\\.\\)\\{3\\}\\(?:0\\|1\\(?:[[:digit:]][[:digit:]]?\\)?\\|2\\(?:[0-4][[:digit:]]?\\|5[0-5]?\\|[6-9][[:digit:]]?\\)?\\|[3-9][[:digit:]]?\\)&#34;</span><br></pre></td></tr></table></figure>
</div>

<p>
上面的 <code>range-expression</code> 有问题，下面给出改正和测试如下:
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(setq range-expression ;; Expression and pattern separated for reuse&#10;      `(or &#34;0&#34;&#10;&#9;   (sequence &#34;1&#34; (optional digit (optional digit)))&#10;&#9;   (sequence &#34;2&#34; (optional&#10;&#9;&#9;&#9;  (or&#10;&#9;&#9;&#9;   (sequence (any &#34;0-4&#34;) (optional digit))&#10;&#9;&#9;&#9;   (sequence &#34;5&#34; (optional (any &#34;0-5&#34;)))&#10;&#9;&#9;&#9;   (optional digit))))&#10;&#9;   (sequence (any &#34;3-9&#34;) (optional digit))))&#10;&#10;(setq range-pattern (rx bol (eval range-expression) eol ))&#10;&#10;;; A test for the regular expression&#10;(require &#39;cl)&#10;(cl-every (lambda (number)&#10;&#9;    (s-matches-p range-pattern (number-to-string number)))&#10;&#9;  (number-sequence 0 255))&#10;&#10;(cl-every (lambda (number)&#10;&#9;    (not (s-matches-p range-pattern (number-to-string number))))&#10;&#9;  (number-sequence 256 355))</span><br></pre></td></tr></table></figure>
</div>

<p>
这个表达的想法是匹配第一个数字，然后考虑分支。 即使不深入解释，语法应该是有帮助的;
但三个新的结构值得好好说明下。 首先， <code>optional</code> 或 <code>opt</code> 语法与 <code>zero-or-one</code> 结构等价。
其次， <code>sequence</code> 或 <code>seq</code> 语法主要是一个表达式包装器，其中列表不是一个原子是必需的。
第三， <code>repeat</code> 语法与先前模式的重复构造相同。 不管新的语法如何，问题只是在展示语法。
</p>

<p>
另外，请记住为正则表达式编写测试。
</p>

<p>
在我忘记之前， <code>eval</code> 要求变量存在于解释器中; 这意味着，它们必须在使用之前通过 <code>setq</code> 进行全局设置。
这就是为什么在片段中的两个 <b>setters</b> 分别设置表达和模式的原因。
建议通过 <code>defconst</code> 或 <code>defvar</code> 设置表达式或模式作为重构。 不幸的是， <code>let</code> 不能与 <code>eval</code> 一起工作，但这不是一项巨大的成本。
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><a id="ID-ebebc313-d891-4699-8b60-9633621747d6" name="ID-ebebc313-d891-4699-8b60-9633621747d6"></a><span class="section-number-2">4</span> Groups And Backreferencs</h2>
<div class="outline-text-2" id="text-4">

<pre class="example">
‘(submatch SEXP1 SEXP2 ...)’
‘(group SEXP1 SEXP2 ...)’
     like ‘and’, but makes the match accessible with ‘match-end’,
     ‘match-beginning’, and ‘match-string’.

‘(submatch-n N SEXP1 SEXP2 ...)’
‘(group-n N SEXP1 SEXP2 ...)’
     like ‘group’, but make it an explicitly-numbered group with
     group number N.
</pre>

<p>
问题：创建一个正则表达式，以yyyy-mm-dd格式匹配任何日期，并分别捕获年，月和日。 作为额外的挑战，请将组命名。
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(setq date-pattern&#10;      (rx (group-n 3 (repeat 4 digit))&#10;&#9;  &#34;-&#34;&#10;&#9;  (group-n 2 (repeat 2 digit))&#10;&#9;  &#34;-&#34;&#10;&#9;  (group-n 1 (repeat 2 digit))))&#10;&#10;(s-match-strings-all date-pattern&#10;&#9;&#9;     (format-time-string &#34;%F&#34;))&#10;&#10;;; Output and pattern, notice it is day, month and year or reverse order&#10;&#34;\\(?3:[[:digit:]]\\{4\\}\\)-\\(?2:[[:digit:]]\\{2\\}\\)-\\(?1:[[:digit:]]\\{2\\}\\)&#34;&#10;&#39;((&#34;2017-03-30&#34; &#34;30&#34; &#34;03&#34; &#34;2017&#34;))</span><br></pre></td></tr></table></figure>
</div>
<p>
捕获 <code>group</code> 是本质的, 这是语法起作用的地方。
命名 <code>group</code> 在这里是不可能的，相反，仅限于编号 <code>group</code> 。
需要注意的，这不是宏的限制，而是 <code>Emacs Lisp</code> 正则表达式语法的限制。
</p>

<p>
<code>group-n</code> 或 <code>group</code> 语法在意图上很明显。 第一个参数代表组号，其余的是实际的表达式。 没有什么花哨。
</p>

<p>
问题：创建一个正则表达式，以yyyy-mm-dd格式匹配“神奇”日期。
如果年份减去世纪，月份和月份的日期都是相同的数字，则日期是神奇的。
例如，2008-08-08是一个神奇的约会。
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(setq magical-pattern&#10;      (rx&#10;       (repeat 2 digit)&#10;       (group-n 1 (repeat 2 digit))&#10;       &#34;-&#34;&#10;       (backref 1)&#10;       &#34;-&#34;&#10;       (backref 1)))&#10;&#10;(s-matches-p magical-pattern&#10;&#9;     &#34;2008-08-08&#34;)&#10;&#10;;; Generated pattern&#10;&#34;[[:digit:]]\\{2\\}\\(?1:[[:digit:]]\\{2\\}\\)-\\1-\\1&#34;</span><br></pre></td></tr></table></figure>
</div>
<p>
这只是显示反向引用可用。 <code>backref</code> 语法只是用数字参数调用组。 再一次，没什么复杂的。
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><a id="ID-2f7598cf-003b-4394-9389-46021ba79551" name="ID-2f7598cf-003b-4394-9389-46021ba79551"></a><span class="section-number-2">5</span> re-builder</h2>
<div class="outline-text-2" id="text-5">

<p>
为了更好的检测编写的正则表达式， <code>Emacs</code> 中存在用于测试和试验正则表达式的用户界面： <code>re-builder</code> 。
在包含文本的缓冲区上执行命令 <code>re-builder</code> 或 <code>regexp-builder</code> ，然后执行 <code>reb-change-syntax</code> 并选择 <code>rx</code> 。
如下图所示。
</p>
<div class="export">
<p>
&lt;img src="<img src="http://francismurillo.github.io/hacker/images/exploring-emacs-rx--screencast.gif" alt="exploring-emacs-rx--screencast.gif">" /&gt;
</p>

</div>
<p>
这个UI可以处理原始表达式，但我们这里只对rx感兴趣。
详细说明，每次表达式更新时，它都会突出显示任何可能的匹配项。
虽然它不像动态或程序化，但它作为一个快速实验和检查很方便。
</p>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><a id="ID-4a6f9d8d-9929-40e4-9aa0-49b65334d3f0" name="ID-4a6f9d8d-9929-40e4-9aa0-49b65334d3f0"></a><span class="section-number-2">6</span> 总结</h2>
<div class="outline-text-2" id="text-6">

<p>
<code>rx</code> 宏不能作为学习正则表达式的替代品，因为它构建的DSL不能完全覆盖所有的细节。但是写原始的正则表达式，真是很痛苦，
所以使用 <code>rx</code> 宏可在更高的抽象等级上来构造正则表达式，可在更清晰的语义下，构造正则表达式。
上面没有给出所有的正则语法构造，只给出一些常用的特征，有任何疑惑，请直接阅读函数文档。
</p>
</div>
</div>

Last Updated 2018-03-01 Thu 21:57.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="http://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 25.3.2 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 8.2.10)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2018/01/26/go-imp-ecrg/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/26/go-imp-ecrg/" itemprop="url">Go实现鼓励金发放逻辑</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-26T00:00:00+08:00">
                2018-01-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/技术积累/" itemprop="url" rel="index">
                    <span itemprop="name">技术积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/26/go-imp-ecrg/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/01/26/go-imp-ecrg/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            

<p>
  什么是鼓励金？我想大家应该都有用过，例如今早我买包子时，就抵扣了部分金额。
用支付宝或者微信支付，支付成功后会返还一小笔钱，从周日到周四累计5天，然后在周五和周六抵现金使用，
这笔钱就是鼓励金(当然支付宝称作奖励金)。
我们现在几乎每天都在使用支付宝或者微信，每天都会接触鼓励金，但是你知道鼓励金发放的一般逻辑嘛，
或者说如果让你来做一个类似鼓励金一样的产品，你会怎样来实现发放逻辑呢。
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><a id="ID-013c67fb-f943-485c-ab55-ad47bf0e4304" name="ID-013c67fb-f943-485c-ab55-ad47bf0e4304"></a><span class="section-number-2">1</span> 问题描述</h2>
<div class="outline-text-2" id="text-1">
<p>
问题描述，洋气一点，可以称作产品需求，需求如下：
</p>
<ul class="org-ul">
<li>根据订单金额分阶段发放,金额越高，得到的鼓励金要相应升高
</li>
<li>每个金额阶段中再分层，每个层次指定发放金额的最小值和最大值，并指定百分比
</li>
<li>商家可以根据上述两条规则自定义自己的发放逻辑
</li>
<li>商家可分时段自定义发放倍率(放大或者缩小发送的金额)
</li>
<li>平台可自定义全平台的发放倍率
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><a id="ID-854271ac-9260-4351-8433-6af146e14440" name="ID-854271ac-9260-4351-8433-6af146e14440"></a><span class="section-number-2">2</span> 解决思路与数据结构设计</h2>
<div class="outline-text-2" id="text-2">

<p>
数据结构如下：
</p>
<div class="org-src-container">

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Ecrg_fee_dura <span class="keyword">struct</span> {</span><br><span class="line">  Upper <span class="typename">float64</span></span><br><span class="line">  Lower <span class="typename">float64</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Ecrg_fee_item <span class="keyword">struct</span> {</span><br><span class="line">  Num  <span class="typename">int</span></span><br><span class="line">  Dura *Ecgr_fee_dura</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Ecrg_fee <span class="keyword">struct</span> {</span><br><span class="line">  Amount   <span class="typename">float64</span></span><br><span class="line">  Item_arr []*Ecgr_fee_item</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Ecrg_fee_arr []*Ecrg_fee = []*Ecrg_fee{</span><br><span class="line">  &amp;Ecrg_fee{</span><br><span class="line">    Amount: <span class="number">99.99</span>,</span><br><span class="line">    Item_arr: []*Ecrg_fee_item{</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">700</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">1.1</span>, Lower: <span class="number">0.8</span>}},</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">900</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">2.0</span>, Lower: <span class="number">1.0</span>}},</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">1000</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">5.0</span>, Lower: <span class="number">1.8</span>}},</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  &amp;Ecrg_fee{</span><br><span class="line">    Amount: <span class="number">49.99</span>,</span><br><span class="line">    Item_arr: []*Ecrg_fee_item{</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">700</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">0.6</span>, Lower: <span class="number">0.25</span>}},</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">900</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">1.25</span>, Lower: <span class="number">0.5</span>}},</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">1000</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">2.0</span>, Lower: <span class="number">1.0</span>}},</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  &amp;Ecrg_fee{</span><br><span class="line">    Amount: <span class="number">29.99</span>,</span><br><span class="line">    Item_arr: []*Ecrg_fee_item{</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">700</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">0.4</span>, Lower: <span class="number">0.25</span>}},</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">900</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">0.6</span>, Lower: <span class="number">0.3</span>}},</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">1000</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">1.0</span>, Lower: <span class="number">0.5</span>}},</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  &amp;Ecrg_fee{</span><br><span class="line">    Amount: <span class="number">19.99</span>,</span><br><span class="line">    Item_arr: []*Ecrg_fee_item{</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">700</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">0.25</span>, Lower: <span class="number">0.1</span>}},</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">900</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">0.5</span>, Lower: <span class="number">0.2</span>}},</span><br><span class="line">      &amp;Ecrg_fee_item{Num: <span class="number">1000</span>, Dura: &amp;Ecrg_fee_dura{Upper: <span class="number">0.8</span>, Lower: <span class="number">0.4</span>}},</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<p>
给出数据结构和规则列表示例，应该就明白一半了，另一半的说明如下:
</p>
<ul class="org-ul">
<li><code>Ecrg_fee_arr</code> 数组金额是从高到底，这里使用有序的列表来表示区间，第一项代表区间99.99到无限大，第二项代表49.99到99.99&#x2026;
</li>
<li><code>Ecrg_fee_item</code> 定义了中奖规则，由一个整数 <code>Num</code> 和一个区间 <code>Dura</code> 组成，
<code>Dura</code> 代表发放金额的上限和下限， <code>Num</code> 就要放到数组中来理解, 同样这里也使用了有序数组来表示区间，只不过这里使用的是递增数组。
<code>Item_arr</code> 的第一项表示1-700,代表的含义是随机1-1000，命中1-700的概率，也就是说这里使用此项定义出70%的概率区间;
第二项表示701-900，代表的含义是随机1-1000，命中701-900的概率，也就是说这里使用此项定义出20%的概率区间&#x2026;
</li>
<li>数据结构和以上的解析基本映射出相应的算法执行步骤：
<ol class="org-ol">
<li>比对金额，定位金额区间
</li>
<li>生成随机数，定位发放规则
</li>
<li>生成随机数，生成鼓励金
</li>
</ol>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><a id="ID-c41c69d8-a4f5-409d-9263-bd9b471b4266" name="ID-c41c69d8-a4f5-409d-9263-bd9b471b4266"></a><span class="section-number-2">3</span> 编码实现</h2>
<div class="outline-text-2" id="text-3">

<div class="org-src-container">

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 四舍五入</span></span><br><span class="line"><span class="keyword">func</span> FormatPrice(p <span class="typename">float64</span>) <span class="typename">float64</span> {</span><br><span class="line">  p = math.Floor((p+<span class="number">0.005</span>)*<span class="number">100</span>) / <span class="number">100</span></span><br><span class="line">  <span class="keyword">return</span> math.Max(p, <span class="number">0.01</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取全平台倍率</span></span><br><span class="line"><span class="keyword">func</span> GetEcrgFactor() <span class="typename">float64</span> {</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1.0</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取鼓励金发放订单最低金额</span></span><br><span class="line"><span class="keyword">func</span> GetEcrgThreshold() <span class="typename">float64</span> {</span><br><span class="line">  <span class="keyword">return</span> <span class="number">9.9</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> CalcEcrgAmount(</span><br><span class="line">  amount <span class="typename">float64</span>, <span class="comment">// 订单金额</span></span><br><span class="line">  factor <span class="typename">float64</span>, <span class="comment">// 发放倍率</span></span><br><span class="line">  ecrg_fee_arr []*Ecrg_fee, <span class="comment">// 发放规则</span></span><br><span class="line">) (</span><br><span class="line">  ecrg_amount <span class="typename">float64</span>,</span><br><span class="line">  code <span class="typename">int</span>, err error,</span><br><span class="line">) {</span><br><span class="line">  <span class="keyword">if</span> amount &lt; Ecrg_amount_threshold {</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加鼓励金发放倍率</span></span><br><span class="line">  factor = factor * GetEcrgFactor()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 规则未定义</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(ecrg_fee_arr) &lt; <span class="number">1</span> {</span><br><span class="line">    ecrg_amount = amount * <span class="number">0.01</span> * factor</span><br><span class="line">    ecrg_amount = FormatPrice(ecrg_amount)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  rand.Seed(time.Now().UnixNano())</span><br><span class="line">  <span class="comment">// 遍历区间列表</span></span><br><span class="line">  <span class="keyword">for</span> index, _ := <span class="keyword">range</span> ecrg_fee_arr {</span><br><span class="line">    ecrg_fee := ecrg_fee_arr[index]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定位金额区间</span></span><br><span class="line">    <span class="keyword">if</span> amount-ecrg_fee.Amount &gt; <span class="number">0.001</span> {</span><br><span class="line">      <span class="comment">// 生成随机数--用于定位发放规则</span></span><br><span class="line">      rand_num := rand.Intn(<span class="number">1000</span>) + <span class="number">1</span></span><br><span class="line">      <span class="keyword">for</span> index, _ := <span class="keyword">range</span> ecrg_fee.Item_arr {</span><br><span class="line">	ecrg_item := ecrg_fee.Item_arr[index]</span><br><span class="line">	<span class="comment">// 定位中奖区间</span></span><br><span class="line">	<span class="keyword">if</span> rand_num &lt;= ecrg_item.Num {</span><br><span class="line">	  fee_dura := ecrg_item.Dura</span><br><span class="line">	  <span class="comment">// 生成随机数--用于生成发放金额</span></span><br><span class="line">	  rand_n := rand.Intn(<span class="number">100</span>) + <span class="number">1</span></span><br><span class="line">	  <span class="comment">// 生成发放金额</span></span><br><span class="line">	  ecrg_amount = fee_dura.Lower + ((<span class="typename">float64</span>(rand_n)/<span class="number">100.00</span>)*</span><br><span class="line">	    (fee_dura.Upper-fee_dura.Lower))*factor</span><br><span class="line">	  log.Printf(<span class="string">"[CalcEcrgAmount] amount: %v, factor %v, "</span>+</span><br><span class="line">	    <span class="string">"rand_num: %v, rand_n: %v, dura: %v, ecrg_amount: %v"</span>,</span><br><span class="line">	    amount, factor, rand_num, rand_n, *fee_dura, ecrg_amount,</span><br><span class="line">	  )</span><br><span class="line"></span><br><span class="line">	  <span class="comment">// 发放金额格式化</span></span><br><span class="line">	  ecrg_amount = FormatPrice(ecrg_amount)</span><br><span class="line">	  <span class="keyword">return</span></span><br><span class="line">	}</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><a id="ID-4295ac94-dddf-409e-b912-3460e4ab3f63" name="ID-4295ac94-dddf-409e-b912-3460e4ab3f63"></a><span class="section-number-2">4</span> 总结</h2>
<div class="outline-text-2" id="text-4">
<p>
以上给出了一个鼓励金或者奖励金一个粗糙的实现，欢迎大家，给出更好的设计方案，欢迎讨论。
</p>
</div>
</div>

Last Updated 2018-01-29 Mon 18:23.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="http://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 25.3.2 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 8.2.10)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/12/18/tmux-script/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/18/tmux-script/" itemprop="url">tmux自动化</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-18T00:00:00+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/技术积累/" itemprop="url" rel="index">
                    <span itemprop="name">技术积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/18/tmux-script/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/12/18/tmux-script/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line">tmux new <span class="operator">-s</span> htop \; neww <span class="operator">-d</span> <span class="string">'cd ~/ &amp;&amp; htop'</span> \; splitw <span class="operator">-d</span>  \; selectp -t <span class="number">1</span> \; detach</span><br><span class="line">tmux new <span class="operator">-s</span> top \; neww <span class="operator">-d</span> <span class="string">'cd ~/ &amp;&amp; top'</span> \; splitw <span class="operator">-d</span>  \; selectp -t <span class="number">1</span> \; detach</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line">tmux new <span class="operator">-s</span> htop \; \</span><br><span class="line">     send-keys -t htop:<span class="number">0</span> <span class="string">'cd ~/ &amp;&amp; htop'</span> C-m \; \</span><br><span class="line">     splitw <span class="operator">-d</span> \; selectp -t <span class="number">1</span> \; \</span><br><span class="line">     send-keys -t htop:<span class="number">0.1</span> <span class="string">'cd ~/ &amp;&amp; clear'</span> C-m \; detach</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line">CMDS=( <span class="string">"htop"</span> <span class="string">"top"</span> )</span><br><span class="line">CMDPATH=<span class="string">"~"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> cmd <span class="keyword">in</span> <span class="string">"<span class="variable">${CMDS[@]}</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    tmux new <span class="operator">-s</span> <span class="variable">$cmd</span> \; \</span><br><span class="line">	 send-keys -t <span class="variable">$cmd</span>:<span class="number">0</span> <span class="string">'cd '</span><span class="variable">$CMDPATH</span><span class="string">' &amp;&amp; '</span><span class="variable">$cmd</span> C-m \; \</span><br><span class="line">	 splitw <span class="operator">-d</span> \; selectp -t <span class="number">1</span> \; \</span><br><span class="line">	 send-keys -t <span class="variable">$cmd</span>:<span class="number">0.1</span> <span class="string">'cd '</span><span class="variable">$CMDPATH</span><span class="string">' &amp;&amp; clear'</span> C-m \; detach</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line">servs = (<span class="string">"cashier"</span> <span class="string">"notify"</span> <span class="string">"magic"</span> <span class="string">"privacy"</span>)</span><br><span class="line">rootPath = <span class="variable">$GOPATH</span>/src/path-to-serv</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> serv <span class="keyword">in</span> <span class="string">"<span class="variable">${servs[@]}</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    tmux has-session -t <span class="variable">$serv</span></span><br><span class="line">    <span class="keyword">if</span> [ $? = <span class="number">0</span>]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    servPath = <span class="variable">$rootPath</span><span class="string">"/"</span><span class="variable">$serv</span></span><br><span class="line">    tmux new <span class="operator">-s</span> <span class="variable">$serv</span> -n serv \; \</span><br><span class="line">	 send-keys -t <span class="variable">$serv</span>:<span class="number">0</span> <span class="string">'cd '</span><span class="variable">$servPath</span><span class="string">' &amp;&amp; bee run'</span> \; \</span><br><span class="line">	 splitw <span class="operator">-d</span> \; selectp -t <span class="number">1</span> \; \</span><br><span class="line">	 send-keys -t <span class="variable">$serv</span>:<span class="number">0.1</span> <span class="string">'cd '</span><span class="variable">$servPath</span> C-m \; detach</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</div>

Last Updated 2018-01-17 Wed 15:20.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="http://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 25.3.2 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 8.2.10)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/12/09/gdb-ui-just-try/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/09/gdb-ui-just-try/" itemprop="url">GDB-UI试用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-09T00:00:00+08:00">
                2017-12-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/技术积累/" itemprop="url" rel="index">
                    <span itemprop="name">技术积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/09/gdb-ui-just-try/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/12/09/gdb-ui-just-try/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            


<div id="outline-container-org2f8337e" class="outline-2">
<h2 id="org2f8337e"><a id="ID-bdb82cb2-9f8f-4fe4-be8f-ea5afb0a9db6"></a><span class="section-number-2">1</span> 源码</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> {</span><br><span class="line">  <span class="keyword">float</span> a;</span><br><span class="line">  <span class="keyword">float</span> b;</span><br><span class="line">} substruct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> {</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  substruct r;</span><br><span class="line">} c;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">int</span> n = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">int</span> m[<span class="number">10</span>] = {<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">16</span>,<span class="number">25</span>,<span class="number">36</span>,<span class="number">49</span>,<span class="number">64</span>,<span class="number">81</span>};</span><br><span class="line">  n = <span class="number">5</span>;</span><br><span class="line">  myproc(n);</span><br><span class="line">  c.i = <span class="number">1</span>;</span><br><span class="line">  c.r.a = <span class="number">0.5</span>;</span><br><span class="line">  c.r.b = <span class="number">0.25</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myproc</span><span class="params">(n)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> p;</span><br><span class="line">  p = <span class="number">2</span>*n;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Two times %d is %d\n"</span>, n, p);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<p>
用 -g 选项编译程序：
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cc -g -c myproc.c</span><br><span class="line">cc -g -o myprog myprog.c myproc.o</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orgb9afbe9" class="outline-2">
<h2 id="orgb9afbe9"><a id="ID-005e298e-7e90-45ca-9cac-d842a25e6e8b"></a><span class="section-number-2">2</span> 使用</h2>
<div class="outline-text-2" id="text-2">
<p>
参见<a href="http://tigersoldier.is-programmer.com/2010/3/26/use-gdb-in-emacs.16324.html" rel="external nofollow noopener noreferrer" target="_blank">在Emacs中使用gdb调试程序</a>。
</p>
</div>
</div>

Last Updated 2017-12-11 Mon 13:54.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="https://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 25.3.2 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 9.1.4)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/12/09/go-dlv-try/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/09/go-dlv-try/" itemprop="url">go-dlv试用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-09T00:00:00+08:00">
                2017-12-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/技术积累/" itemprop="url" rel="index">
                    <span itemprop="name">技术积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/09/go-dlv-try/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/12/09/go-dlv-try/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            


<div id="outline-container-orgab0c325" class="outline-2">
<h2 id="orgab0c325"><a id="ID-1c90dda7-ff8f-43e7-9934-0d7c67e1c0c3"></a><span class="section-number-2">1</span> 源码</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> dostuff(wg *sync.WaitGroup, i <span class="typename">int</span>) {</span><br><span class="line">  fmt.Printf(<span class="string">"goroutine id %d\n"</span>, i)</span><br><span class="line">  time.Sleep(<span class="number">300</span> * time.Second)</span><br><span class="line">  fmt.Printf(<span class="string">"goroutine id %d\n"</span>, i)</span><br><span class="line">  wg.Done()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() {</span><br><span class="line">  <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">  workers := <span class="number">10</span></span><br><span class="line"></span><br><span class="line">  wg.Add(workers)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; workers; i++ {</span><br><span class="line">    <span class="keyword">go</span> dostuff(&amp;wg, i)</span><br><span class="line">  }</span><br><span class="line">  wg.Wait()</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

Last Updated 2017-12-10 Sun 16:57.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="https://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 25.3.2 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 9.1.4)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/12/05/emacs-go-tag/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/05/emacs-go-tag/" itemprop="url">Emacs支持gomodifytags</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-05T00:00:00+08:00">
                2017-12-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/emacs-plugin/" itemprop="url" rel="index">
                    <span itemprop="name">emacs-plugin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/05/emacs-go-tag/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/12/05/emacs-go-tag/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            

<p>
受到<a href="http://www.jianshu.com/p/20b533c5c3f9" rel="external nofollow noopener noreferrer" target="_blank">《Go 终极指南：编写一个 Go 工具》</a>的启发，萌生了把 <a href="https://github.com/fatih/gomodifytags" rel="external nofollow noopener noreferrer" target="_blank">gomodifytags</a> 封装成emacs-plugin的想法，
然后经过两周的努力，诞生了<a href="https://github.com/brantou/emacs-go-tag" rel="external nofollow noopener noreferrer" target="_blank">emacs-go-tag</a>。
<code>emacs-go-tag</code> 实现了两个命令： <code>go-tag-add</code> 添加结构体字段tag， <code>go-tag-remove</code> 删除结构体字段tag。
</p>

<div id="outline-container-orgc48f952" class="outline-2">
<h2 id="orgc48f952"><a id="ID-c1a9f516-96c0-43f0-a40e-3541cc0e5014"></a><span class="section-number-2">1</span> 安装依赖</h2>
<div class="outline-text-2" id="text-1">
<p>
<code>emacs-go-tag</code> 有两个依赖项， <code>gomodifytags</code> 和 <a href="https://github.com/dominikh/go-mode.el" rel="external nofollow noopener noreferrer" target="_blank">go-mode.el</a>，若使用emacs做Go开发 <code>go-mode.el</code> 应该已经在使用了。
gomodifytags安装如下:
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u github.com/fatih/gomodifytags</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orged22cb8" class="outline-2">
<h2 id="orged22cb8"><a id="ID-dcb13c65-0204-4e14-8446-9c0e5e3fe2be"></a><span class="section-number-2">2</span> 安装</h2>
<div class="outline-text-2" id="text-2">
<p>
目前emacs-go-tag已发布到了<a href="https://melpa.org/" rel="external nofollow noopener noreferrer" target="_blank">MELPA</a>上，可使用如下命令安装：
<code>M-x package-install [RET] go-tag [RET]</code>
若是没发现go-tag,你需要使用如下命令来刷新,然后在使用上面的命令进行安装:
<code>M-x package-refresh-contents [RET]</code>
</p>
</div>
</div>

<div id="outline-container-org72fc9aa" class="outline-2">
<h2 id="org72fc9aa"><a id="ID-fc076558-8801-441a-a81c-d8b7b380046f"></a><span class="section-number-2">3</span> 配置</h2>
<div class="outline-text-2" id="text-3">
<p>
目前 <code>gomodifytags</code> 支持三种转换如下：
</p>
<ul class="org-ul">
<li>snakecase: BaseDomain -&gt; base_domain</li>
<li>camelcase: BaseDomain -&gt; baseDomain</li>
<li>lispcase: BaseDomain -&gt; base-domain</li>
</ul>

<p>
默认使用 <code>snakecase</code> , 若你准备使用 <code>camelcase</code>, 可配置如下：
</p>
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(setq go-tag-args (list &#34;-transform&#34; &#34;camelcase&#34;))</span><br></pre></td></tr></table></figure>
</div>

<p>
快捷键配置示例：
</p>
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(with-eval-after-load &#39;go-mode&#10;  (define-key go-mode-map (kbd &#34;C-c t&#34;) #&#39;go-tag-add)&#10;  (define-key go-mode-map (kbd &#34;C-c T&#34;) #&#39;go-tag-remove))</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orga466eb8" class="outline-2">
<h2 id="orga466eb8"><a id="ID-115052a8-4563-4ddc-a6cb-7f8a37fe8746"></a><span class="section-number-2">4</span> 使用说明</h2>
<div class="outline-text-2" id="text-4">
<p>
  若是你有使用 vim-go 的 <code>GoAddTags</code> 和 <code>GoRemoveTags</code> 命令的经验， 那么你会很快上手 <code>emacs-go-tag</code>,
因为两者的行为完全一致（若有不同，请反馈）。
</p>
</div>
<div id="outline-container-org7fe761d" class="outline-3">
<h3 id="org7fe761d"><a id="ID-1bda75e3-95d3-44e4-b511-302dc6596fff"></a><span class="section-number-3">4.1</span> <code>go-tag-add</code></h3>
<div class="outline-text-3" id="text-4-1">
<p>
<code>:[range] go-tag-add [key],[option] [key1],[option] …</code>
为结构体字段添加tag。如果在一个结构中调用，会自动添加json字段tag。
若在结构体之外调用，或者文件格式不正确，则会给出错误消息。
</p>

<p>
如果给出 <code>[range]</code> ，则只有选定的字段将被改变。
</p>

<p>
默认的json可以通过提供一个或多个 <code>[key]</code> 参数来改变。
添加xml和db的例子是：
<code>:go-tag-add xml db</code>
</p>

<p>
若提供了 <code>[option]</code> 也提供了，会在添加tag时，一同添加 <code>option</code> , 或者修改已存在的tag。 如下：
<code>:go-tag-add json,omitempty</code>
</p>

<p>
也可以定义一个常数值而不是默认的基于字段的值。 例如，以下命令将添加`valid：“1”`到所有字段。
<code>:go-tag-add valid=1</code>
</p>

<img src="https://github.com/brantou/emacs-go-tag/raw/master/img/go-tag-add.gif">
</div>
</div>

<div id="outline-container-org6024715" class="outline-3">
<h3 id="org6024715"><a id="ID-1dd1e27b-cb8e-4caf-b6ec-244226ad4499"></a><span class="section-number-3">4.2</span> <code>go-tag-remove</code></h3>
<div class="outline-text-3" id="text-4-2">
<p>
<code>:[range] go-tag-add [key],[option] [key1],[option] …</code>
 移除结构字段的字段标记。 如果在一个结构中调用，它会自动删除所有的字段tag。
 如果在结构体定义之外调用，或者文件格式不正确，则会给出错误消息。
</p>

<p>
如果给出 <code>[range]</code> ，则只有选定的字段将被改变。
</p>

<p>
如果给出 <code>[key]</code> ，则只会删除这些key相关的tag。 如下只删除json相关的tag：
<code>:go-tag-remove json</code>
</p>

<p>
如果 <code>[option]</code> 和 <code>[key]</code> 一同传递，则只会删除 <code>option</code> 。
例如，下面命令只会从包含json的字段中删除omitempty选项：
<code>:go-tag-remove json,omitempty</code>
</p>

<img src="https://github.com/brantou/emacs-go-tag/raw/master/img/go-tag-remove.gif">
</div>
</div>
</div>

<div id="outline-container-org387a0cc" class="outline-2">
<h2 id="org387a0cc"><a id="ID-9437067b-8701-479f-b594-84460bf62310"></a><span class="section-number-2">5</span> 最后</h2>
<div class="outline-text-2" id="text-5">
<p>
感谢 <code>GoCN每日新闻</code> 的每日推送，让我得以读到 <a href="http://www.jianshu.com/p/20b533c5c3f9" rel="external nofollow noopener noreferrer" target="_blank">《Go 终极指南：编写一个 Go 工具》</a>, 然后我才得以写出这个emacs-plugin。
这里给出项目地址：<a href="https://github.com/brantou/emacs-go-tag" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/brantou/emacs-go-tag</a>, 欢迎大家来使用和来提问题，若是你觉得对你有帮助， <code>就给颗星</code> 吧。
</p>
</div>
</div>

Last Updated 2017-12-08 Fri 12:31.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="https://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 24.5.1 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 9.1.4)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/11/24/go-tool/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/24/go-tool/" itemprop="url">Go语言不完全工具列表</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-24T00:00:00+08:00">
                2017-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/技术积累/" itemprop="url" rel="index">
                    <span itemprop="name">技术积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/24/go-tool/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/11/24/go-tool/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            


<div id="outline-container-org9744b49" class="outline-2">
<h2 id="org9744b49"><a id="ID-1da2b186-ec5a-4c33-87fc-4edd8cdc60ff"></a><span class="section-number-2">1</span> impl</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">go get -u github.com/josharian/impl</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">impl -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of impl:
  -dir string
      package source directory, useful for vendored code
</pre>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">impl &#39;f *File&#39; io.ReadWriteCloser</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> (f *File) Read(p []<span class="typename">byte</span>) (n <span class="typename">int</span>, err error) {</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">"not implemented"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (f *File) Write(p []<span class="typename">byte</span>) (n <span class="typename">int</span>, err error) {</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">"not implemented"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (f *File) Close() error {</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">"not implemented"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orgebb67d7" class="outline-2">
<h2 id="orgebb67d7"><a id="ID-251f4189-ea0e-4de2-a3c2-10f537e227b4"></a><span class="section-number-2">2</span> gomodifytags</h2>
<div class="outline-text-2" id="text-2">
<p>
请参见之前的文章<a href="https://brantou.github.io/2017/11/07/go-modify-tags/">gomodifytags</a>。
</p>
</div>
</div>

<div id="outline-container-orgd3d1e92" class="outline-2">
<h2 id="orgd3d1e92"><a id="ID-42607192-5087-43d2-b6e7-8af2bb30a487"></a><span class="section-number-2">3</span> go-outline</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u github.com/lukehoban/go-outline</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go-outline -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of go-outline:
  -f string
      the path to the file to outline
  -imports-only
      parse imports only
  -src string
      source code of the file to outline
</pre>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Outline <span class="keyword">struct</span> {</span><br><span class="line">  Label <span class="typename">string</span></span><br><span class="line">  Type  <span class="typename">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (ol *Outline) Label() <span class="typename">string</span> {</span><br><span class="line">  <span class="keyword">return</span> ol.Label</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  name = <span class="string">"brantou"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> email = <span class="string">"brantou89@gmail.com"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  cmd  <span class="typename">string</span></span><br><span class="line">  args <span class="typename">string</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() {</span><br><span class="line">  fmt.Printf(<span class="string">"hello world!"</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go-outline <span class="operator">-f</span> main.go</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    {</span><br><span class="line">        "<span class="attribute">label</span>": <span class="value"><span class="string">"main"</span></span>,</span><br><span class="line">        "<span class="attribute">type</span>": <span class="value"><span class="string">"package"</span></span>,</span><br><span class="line">        "<span class="attribute">start</span>": <span class="value"><span class="number">1</span></span>,</span><br><span class="line">        "<span class="attribute">end</span>": <span class="value"><span class="number">290</span></span>,</span><br><span class="line">        "<span class="attribute">children</span>": <span class="value">[</span><br><span class="line">            {</span><br><span class="line">                "<span class="attribute">label</span>": <span class="value"><span class="string">"\"fmt\""</span></span>,</span><br><span class="line">                "<span class="attribute">type</span>": <span class="value"><span class="string">"import"</span></span>,</span><br><span class="line">                "<span class="attribute">start</span>": <span class="value"><span class="number">23</span></span>,</span><br><span class="line">                "<span class="attribute">end</span>": <span class="value"><span class="number">28</span></span><br><span class="line">            </span>},</span><br><span class="line">            {</span><br><span class="line">                "<span class="attribute">label</span>": <span class="value"><span class="string">"Outline"</span></span>,</span><br><span class="line">                "<span class="attribute">type</span>": <span class="value"><span class="string">"type"</span></span>,</span><br><span class="line">                "<span class="attribute">start</span>": <span class="value"><span class="number">35</span></span>,</span><br><span class="line">                "<span class="attribute">end</span>": <span class="value"><span class="number">83</span></span><br><span class="line">            </span>},</span><br><span class="line">            {</span><br><span class="line">                "<span class="attribute">label</span>": <span class="value"><span class="string">"Label"</span></span>,</span><br><span class="line">                "<span class="attribute">type</span>": <span class="value"><span class="string">"function"</span></span>,</span><br><span class="line">                "<span class="attribute">receiverType</span>": <span class="value"><span class="string">"*Outline"</span></span>,</span><br><span class="line">                "<span class="attribute">start</span>": <span class="value"><span class="number">85</span></span>,</span><br><span class="line">                "<span class="attribute">end</span>": <span class="value"><span class="number">140</span></span><br><span class="line">            </span>},</span><br><span class="line">            {</span><br><span class="line">                "<span class="attribute">label</span>": <span class="value"><span class="string">"name"</span></span>,</span><br><span class="line">                "<span class="attribute">type</span>": <span class="value"><span class="string">"constant"</span></span>,</span><br><span class="line">                "<span class="attribute">start</span>": <span class="value"><span class="number">152</span></span>,</span><br><span class="line">                "<span class="attribute">end</span>": <span class="value"><span class="number">156</span></span><br><span class="line">            </span>},</span><br><span class="line">            {</span><br><span class="line">                "<span class="attribute">label</span>": <span class="value"><span class="string">"email"</span></span>,</span><br><span class="line">                "<span class="attribute">type</span>": <span class="value"><span class="string">"constant"</span></span>,</span><br><span class="line">                "<span class="attribute">start</span>": <span class="value"><span class="number">178</span></span>,</span><br><span class="line">                "<span class="attribute">end</span>": <span class="value"><span class="number">183</span></span><br><span class="line">            </span>},</span><br><span class="line">            {</span><br><span class="line">                "<span class="attribute">label</span>": <span class="value"><span class="string">"cmd"</span></span>,</span><br><span class="line">                "<span class="attribute">type</span>": <span class="value"><span class="string">"variable"</span></span>,</span><br><span class="line">                "<span class="attribute">start</span>": <span class="value"><span class="number">217</span></span>,</span><br><span class="line">                "<span class="attribute">end</span>": <span class="value"><span class="number">220</span></span><br><span class="line">            </span>},</span><br><span class="line">            {</span><br><span class="line">                "<span class="attribute">label</span>": <span class="value"><span class="string">"args"</span></span>,</span><br><span class="line">                "<span class="attribute">type</span>": <span class="value"><span class="string">"variable"</span></span>,</span><br><span class="line">                "<span class="attribute">start</span>": <span class="value"><span class="number">231</span></span>,</span><br><span class="line">                "<span class="attribute">end</span>": <span class="value"><span class="number">235</span></span><br><span class="line">            </span>},</span><br><span class="line">            {</span><br><span class="line">                "<span class="attribute">label</span>": <span class="value"><span class="string">"main"</span></span>,</span><br><span class="line">                "<span class="attribute">type</span>": <span class="value"><span class="string">"function"</span></span>,</span><br><span class="line">                "<span class="attribute">start</span>": <span class="value"><span class="number">246</span></span>,</span><br><span class="line">                "<span class="attribute">end</span>": <span class="value"><span class="number">290</span></span><br><span class="line">            </span>}</span><br><span class="line">        ]</span><br><span class="line">    </span>}</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go-outline <span class="operator">-f</span> main.go -imports-only</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>
<div id="outline-container-orge0cec45" class="outline-2">
<h2 id="orge0cec45"><a id="ID-498d0e01-e59e-406e-82db-bbe477366bf6"></a><span class="section-number-2">4</span> go-symbols</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u github.com/newhook/go-symbols</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go-symbols -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of go-symbols:
  -tags build tags
      a list of build tags to consider satisfied during the build. For more information about build tags, see the description of build constraints in the documentation for the go/build package
</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go-symbols <span class="variable">$GOPATH</span>/src/github.com/astaxie/beego beego</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line"> {</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"BeegoOutput"</span></span>,</span><br><span class="line">  "<span class="attribute">kind</span>": <span class="value"><span class="string">"type"</span></span>,</span><br><span class="line">  "<span class="attribute">package</span>": <span class="value"><span class="string">"context"</span></span>,</span><br><span class="line">  "<span class="attribute">path</span>": <span class="value"><span class="string">"/home/parallels/.gvm/pkgsets/go1.9/global/src/github.com/astaxie/beego/context/output.go"</span></span>,</span><br><span class="line">  "<span class="attribute">line</span>": <span class="value"><span class="number">35</span></span>,</span><br><span class="line">  "<span class="attribute">character</span>": <span class="value"><span class="number">0</span></span><br><span class="line"> </span>},</span><br><span class="line"> {</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"BeegoInput"</span></span>,</span><br><span class="line">  "<span class="attribute">kind</span>": <span class="value"><span class="string">"type"</span></span>,</span><br><span class="line">  "<span class="attribute">package</span>": <span class="value"><span class="string">"context"</span></span>,</span><br><span class="line">  "<span class="attribute">path</span>": <span class="value"><span class="string">"/home/parallels/.gvm/pkgsets/go1.9/global/src/github.com/astaxie/beego/context/input.go"</span></span>,</span><br><span class="line">  "<span class="attribute">line</span>": <span class="value"><span class="number">43</span></span>,</span><br><span class="line">  "<span class="attribute">character</span>": <span class="value"><span class="number">0</span></span><br><span class="line"> </span>},</span><br><span class="line"> {</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"NewBeegoRequest"</span></span>,</span><br><span class="line">  "<span class="attribute">kind</span>": <span class="value"><span class="string">"func"</span></span>,</span><br><span class="line">  "<span class="attribute">package</span>": <span class="value"><span class="string">"httplib"</span></span>,</span><br><span class="line">  "<span class="attribute">path</span>": <span class="value"><span class="string">"/home/parallels/.gvm/pkgsets/go1.9/global/src/github.com/astaxie/beego/httplib/httplib.go"</span></span>,</span><br><span class="line">  "<span class="attribute">line</span>": <span class="value"><span class="number">80</span></span>,</span><br><span class="line">  "<span class="attribute">character</span>": <span class="value"><span class="number">0</span></span><br><span class="line"> </span>},</span><br><span class="line"> {</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"BeegoHTTPSettings"</span></span>,</span><br><span class="line">  "<span class="attribute">kind</span>": <span class="value"><span class="string">"type"</span></span>,</span><br><span class="line">  "<span class="attribute">package</span>": <span class="value"><span class="string">"httplib"</span></span>,</span><br><span class="line">  "<span class="attribute">path</span>": <span class="value"><span class="string">"/home/parallels/.gvm/pkgsets/go1.9/global/src/github.com/astaxie/beego/httplib/httplib.go"</span></span>,</span><br><span class="line">  "<span class="attribute">line</span>": <span class="value"><span class="number">130</span></span>,</span><br><span class="line">  "<span class="attribute">character</span>": <span class="value"><span class="number">0</span></span><br><span class="line"> </span>},</span><br><span class="line"> {</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"BeegoHTTPRequest"</span></span>,</span><br><span class="line">  "<span class="attribute">kind</span>": <span class="value"><span class="string">"type"</span></span>,</span><br><span class="line">  "<span class="attribute">package</span>": <span class="value"><span class="string">"httplib"</span></span>,</span><br><span class="line">  "<span class="attribute">path</span>": <span class="value"><span class="string">"/home/parallels/.gvm/pkgsets/go1.9/global/src/github.com/astaxie/beego/httplib/httplib.go"</span></span>,</span><br><span class="line">  "<span class="attribute">line</span>": <span class="value"><span class="number">146</span></span>,</span><br><span class="line">  "<span class="attribute">character</span>": <span class="value"><span class="number">0</span></span><br><span class="line"> </span>}</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>
<div id="outline-container-org7669322" class="outline-2">
<h2 id="org7669322"><a id="ID-462c9dc1-3148-4be0-bf12-751821247f33"></a><span class="section-number-2">5</span> gocode</h2>
<div class="outline-text-2" id="text-5">
<p>
An autocompletion daemon for the Go programming language.
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u -v github.com/nsf/gocode</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gocode -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage: gocode [-s] [-f=&lt;format&gt;] [-in=&lt;path&gt;] [-sock=&lt;type&gt;] [-addr=&lt;addr&gt;]
     &lt;command&gt; [&lt;args&gt;]

Flags:
  -addr string
      address for tcp socket (default "127.0.0.1:37373")
  -debug
      enable server-side debug mode
  -f string
      output format (vim | emacs | nice | csv | csv-with-package | json) (default "nice")
  -in string
      use this file instead of stdin input
  -profile int
      port on which to expose profiling information for pprof; 0 to disable profiling
  -s	run a server instead of a client
  -sock string
      socket type (unix | tcp) (default "unix")

Commands:
  autocomplete [&lt;path&gt;] &lt;offset&gt;     main autocompletion command
  close                              close the gocode daemon
  status                             gocode daemon status report
  drop-cache                         drop gocode daemon's cache
  set [&lt;name&gt; [&lt;value&gt;]]             list or set config options
</pre>
</div>
</div>

<div id="outline-container-org458d6b1" class="outline-2">
<h2 id="org458d6b1"><a id="ID-47e74814-b835-46d4-9aba-309f255f196c"></a><span class="section-number-2">6</span> godef</h2>
<div class="outline-text-2" id="text-6">
<p>
Print where symbols are defined in Go source code.
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u -v github.com/rogpeppe/godef</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">godef -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
usage: godef [flags] [expr]
  -A	print all type and members information
  -a	print public type and member information
  -acme
      use current acme window
  -debug
      debug mode
  -f string
      Go source filename
  -i	read file from stdin
  -json
      output location in JSON format (-t flag is ignored)
  -o int
      file offset of identifier in stdin (default -1)
  -t	print type information
</pre>
</div>
</div>

<div id="outline-container-org9d0e21c" class="outline-2">
<h2 id="org9d0e21c"><a id="ID-62c99ab8-8ebb-4ff8-aa2b-3db15c05f369"></a><span class="section-number-2">7</span> gogetdoc</h2>
<div class="outline-text-2" id="text-7">
<p>
Retrieve documentation for items in Go source code.
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u -v github.com/zmb3/gogetdoc</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gogetdoc -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of gogetdoc
  -cpuprofile string
      write cpu profile to file
  -json
      enable extended JSON output
  -linelength int
      maximum length of a line in the output (in Unicode code points) (default 80)
  -modified
      read an archive of modified files from standard input
  -pos string
      Filename and byte offset of item to document, e.g. foo.go:#123
  -tags build tags
      a list of build tags to consider satisfied during the build. For more information about build tags, see the description of build constraints in the documentation for the go/build package
  -u	show unexported fields

The archive format for the -modified flag consists of the file name, followed
by a newline, the decimal file size, another newline, and the contents of the file.

This allows editors to supply gogetdoc with the contents of their unsaved buffers.
</pre>
</div>
</div>

<div id="outline-container-org1dfd667" class="outline-2">
<h2 id="org1dfd667"><a id="ID-db601da2-3073-45f0-b00d-f326ff290618"></a><span class="section-number-2">8</span> golint</h2>
<div class="outline-text-2" id="text-8">
<p>
Golint is a linter for Go source code.
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u github.com/golang/lint/golint</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">golint -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of golint:
	golint [flags] # runs on package in current directory
	golint [flags] [packages]
	golint [flags] [directories] # where a '/...' suffix includes all sub-directories
	golint [flags] [files] # all must belong to a single package
Flags:
  -min_confidence float
      minimum confidence of a problem to print it (default 0.8)
  -set_exit_status
      set exit status to 1 if any issues are found

</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">golint google.go</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
google.go:19:1: exported function Search should have comment or be unexported
</pre>
</div>
</div>

<div id="outline-container-orge06109c" class="outline-2">
<h2 id="orge06109c"><a id="ID-e280d3b0-98ff-4e2d-9c92-50c2d92976ba"></a><span class="section-number-2">9</span> gopkgs</h2>
<div class="outline-text-2" id="text-9">
<p>
Gopkgs is tools that provide list of available Go packages that can be imported.
This are alternative to <code>go list all</code>, it just faster.
</p>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get github.com/uudashr/gopkgs/cmd/gopkgs</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gopkgs -help</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of gopkgs:
  -format string
      custom output format (default "{ {.ImportPath} }")
  -help
      show this message


Use -format to custom the output using template syntax. The struct being passed to template is:

  type Pkg struct {
      Dir        string // directory containing package sources
      ImportPath string // import path of package in dir
      Name       string // package name
  }
</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gopkgs -format <span class="string">"{ {.Name} };{ {.ImportPath} }"</span></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-org1217219" class="outline-2">
<h2 id="org1217219"><a id="ID-8a91213d-e07e-454e-a015-3625c86bc711"></a><span class="section-number-2">10</span> gorename</h2>
<div class="outline-text-2" id="text-10">
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u -v golang.org/x/tools/cmd/gorename</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gorename -help</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
gorename: precise type-safe renaming of identifiers in Go source code.

Usage:

 gorename (-from &lt;spec&gt; | -offset &lt;file&gt;:#&lt;byte-offset&gt;) -to &lt;name&gt; [-force]

You must specify the object (named entity) to rename using the -offset
or -from flag.  Exactly one must be specified.

Flags:

  -offset    specifies the filename and byte offset of an identifier to rename.
             This form is intended for use by text editors.

  -from      specifies the object to rename using a query notation;
             This form is intended for interactive use at the command line.
             A legal -from query has one of the following forms:

    "encoding/json".Decoder.Decode        method of package-level named type
    (*"encoding/json".Decoder).Decode     ditto, alternative syntax
    "encoding/json".Decoder.buf           field of package-level named struct type
    "encoding/json".HTMLEscape            package member (const, func, var, type)
    "encoding/json".Decoder.Decode::x     local object x within a method
    "encoding/json".HTMLEscape::x         local object x within a function
    "encoding/json"::x                    object x anywhere within a package
    json.go::x                            object x within file json.go

             Double-quotes must be escaped when writing a shell command.
             Quotes may be omitted for single-segment import paths such as "fmt".

             For methods, the parens and '*' on the receiver type are both
             optional.

             It is an error if one of the ::x queries matches multiple
             objects.

  -to        the new name.

  -force     causes the renaming to proceed even if conflicts were reported.
             The resulting program may be ill-formed, or experience a change
             in behaviour.

             WARNING: this flag may even cause the renaming tool to crash.
             (In due course this bug will be fixed by moving certain
             analyses into the type-checker.)

  -d         display diffs instead of rewriting files

  -v         enables verbose logging.

gorename automatically computes the set of packages that might be
affected.  For a local renaming, this is just the package specified by
-from or -offset, but for a potentially exported name, gorename scans
the workspace ($GOROOT and $GOPATH).

gorename rejects renamings of concrete methods that would change the
assignability relation between types and interfaces.  If the interface
change was intentional, initiate the renaming at the interface method.

gorename rejects any renaming that would create a conflict at the point
of declaration, or a reference conflict (ambiguity or shadowing), or
anything else that could cause the resulting program not to compile.


Examples:

$ gorename -offset file.go:#123 -to foo

  Rename the object whose identifier is at byte offset 123 within file file.go.

$ gorename -from '"bytes".Buffer.Len' -to Size

  Rename the "Len" method of the *bytes.Buffer type to "Size".

---- TODO ----

Correctness:
- handle dot imports correctly
- document limitations (reflection, 'implements' algorithm).
- sketch a proof of exhaustiveness.

Features:
- support running on packages specified as *.go files on the command line
- support running on programs containing errors (loader.Config.AllowErrors)
- allow users to specify a scope other than "global" (to avoid being
  stuck by neglected packages in $GOPATH that don't build).
- support renaming the package clause (no object)
- support renaming an import path (no ident or object)
  (requires filesystem + SCM updates).
- detect and reject edits to autogenerated files (cgo, protobufs)
  and optionally $GOROOT packages.
- report all conflicts, or at least all qualitatively distinct ones.
  Sometimes we stop to avoid redundancy, but
  it may give a disproportionate sense of safety in -force mode.
- support renaming all instances of a pattern, e.g.
  all receiver vars of a given type,
  all local variables of a given type,
  all PkgNames for a given package.
- emit JSON output for other editors and tools.

</pre>
</div>
</div>

<div id="outline-container-org189550f" class="outline-2">
<h2 id="org189550f"><a id="ID-62a70222-9660-44be-a5f3-f1ed5bfc70be"></a><span class="section-number-2">11</span> godoctor</h2>
<div class="outline-text-2" id="text-11">
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u -v github.com/godoctor/godoctor</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">godoctor -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage: godoctor [&lt;flag&gt; ...] &lt;refactoring&gt; [&lt;args&gt; ...]

Each &lt;flag&gt; must be one of the following:
    -complete Output entire modified source files instead of displaying a diff
    -doc      Output documentation (install, user, man, or vim) and exit
    -file     Filename containing an element to refactor (default: stdin)
    -json     Accept commands in OpenRefactory JSON protocol format
    -list     List all refactorings and exit
    -pos      Position of a syntax element to refactor (default: entire file)
    -scope    Package name(s), or source file containing a program entrypoint
    -v        Verbose: list affected files
    -vv       Very verbose: list individual edits (implies -v)
    -w        Modify source files on disk (write) instead of displaying a diff


The &lt;refactoring&gt; argument determines the refactoring to perform:
    rename          Changes the name of an identifier
    extract         Extracts statements to a new function/method
    var             Extracts an expression, assigning it to a variable
    toggle          Toggles between a var declaration and := statement
    godoc           Adds stub GoDoc comments where they are missing

The &lt;args&gt; following the refactoring name vary depending on the refactoring.

To display usage information for a particular refactoring, such as rename, use:
    %% godoctor rename

For complete usage information, see the user manual: http://gorefactor.org/doc.html
</pre>
</div>
</div>

<div id="outline-container-org03ac4f0" class="outline-2">
<h2 id="org03ac4f0"><a id="ID-8ece098f-545f-4245-b311-4dece9c55844"></a><span class="section-number-2">12</span> goreturns</h2>
<div class="outline-text-2" id="text-12">
<p>
A gofmt/goimports-like tool for Go programmers that fills
in Go return statements with zero values to match the func return types
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u sourcegraph.com/sqs/goreturns</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> goreturnsdemo</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"errors"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> F() (<span class="typename">int</span>, error) { <span class="keyword">return</span> errors.New(<span class="string">"foo"</span>) }</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">goreturns -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
usage: goreturns [flags] [path ...]
  -b	remove bare returns
  -d	display diffs instead of rewriting files
  -e	report all errors (not just the first 10 on different lines)
  -i	run goimports on the file prior to processing (default true)
  -l	list files whose formatting differs from goreturns's
  -local string
put imports beginning with this string after 3rd-party packages (see goimports)
  -p	print non-fatal typechecking errors to stderr
  -w	write result to (source) file instead of stdout

</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">goreturns goreturnsdemo.go</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> goreturnsdemo</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"errors"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> F() (<span class="typename">int</span>, error) { <span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">"foo"</span>) }</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">goreturns <span class="operator">-d</span> goreturnsdemo.go</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">diff goreturnsdemo.<span class="keyword">go</span> gofmt/goreturnsdemo.<span class="keyword">go</span></span><br><span class="line">--- /tmp/gofmt948886532 <span class="number">2017</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">18</span>:<span class="number">59</span>:<span class="number">03.671955645</span> +<span class="number">0800</span></span><br><span class="line">+++ /tmp/gofmt584282515 <span class="number">2017</span>-<span class="number">11</span>-<span class="number">26</span> <span class="number">18</span>:<span class="number">59</span>:<span class="number">03.671955645</span> +<span class="number">0800</span></span><br><span class="line">@@ -<span class="number">1</span>,<span class="number">6</span> +<span class="number">1</span>,<span class="number">5</span> @@</span><br><span class="line"> <span class="keyword">package</span> goreturnsdemo</span><br><span class="line"></span><br><span class="line">-</span><br><span class="line"> <span class="keyword">import</span> <span class="string">"errors"</span></span><br><span class="line"></span><br><span class="line">-<span class="keyword">func</span> F() (<span class="typename">int</span>, error) { <span class="keyword">return</span> errors.New(<span class="string">"foo"</span>) }</span><br><span class="line">+<span class="keyword">func</span> F() (<span class="typename">int</span>, error) { <span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">"foo"</span>) }</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orgef4a183" class="outline-2">
<h2 id="orgef4a183"><a id="ID-b00fe929-fb7c-4645-9baf-69cada4aed85"></a><span class="section-number-2">13</span> gotests</h2>
<div class="outline-text-2" id="text-13">
<p>
Generate Go tests from your source code.
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u -v github.com/cweill/gotests/...</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gotests -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of gotests:
  -all
      generate tests for all functions and methods
  -excl string
      regexp. generate tests for functions and methods that don't match. Takes precedence over -only, -exported, and -all
  -exported
      generate tests for exported functions and methods. Takes precedence over -only and -all
  -i	print test inputs in error messages
  -nosubtests
      disable generating tests using the Go 1.7 subtests feature
  -only string
      regexp. generate tests for functions and methods that match only. Takes precedence over -all
  -w	write output to (test) files instead of stdout
</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gotests -all ./</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-org2e13124" class="outline-2">
<h2 id="org2e13124"><a id="ID-f19924ac-e110-4510-95a2-0f9789d593f2"></a><span class="section-number-2">14</span> guru</h2>
<div class="outline-text-2" id="text-14">
<p>
guru: a tool for answering questions about Go source code.
</p>
</div>
</div>

<div id="outline-container-org6ea9a3b" class="outline-2">
<h2 id="org6ea9a3b"><a id="ID-acbc4ee2-047d-44e9-8dd2-4cf8f92a1eb0"></a><span class="section-number-2">15</span> godepgraph</h2>
<div class="outline-text-2" id="text-15">
<p>
godepgraph is a program for generating a dependency graph of Go packages.
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get github.com/kisielk/godepgraph</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">godepgraph -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of godepgraph:
  -d	show dependencies of packages in the Go standard library
  -horizontal
      lay out the dependency graph horizontally instead of vertically
  -i string
      a comma-separated list of packages to ignore
  -l int
      max level of go dependency graph (default 256)
  -o string
      a comma-separated list of prefixes to include
  -p string
      a comma-separated list of prefixes to ignore
  -s	ignore packages in the Go standard library
  -t	include test packages
  -tags string
      a comma-separated list of build tags to consider satisified during the build
</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">godepgraph github.com/kisielk/godepgraph</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">digraph godep {&#10;_0 [label=&#34;flag&#34; style=&#34;filled&#34; color=&#34;palegreen&#34;];&#10;_1 [label=&#34;fmt&#34; style=&#34;filled&#34; color=&#34;palegreen&#34;];&#10;_2 [label=&#34;github.com/kisielk/godepgraph&#34; style=&#34;filled&#34; color=&#34;paleturquoise&#34;];&#10;_2 -&#62; _0;&#10;_2 -&#62; _1;&#10;_2 -&#62; _3;&#10;_2 -&#62; _4;&#10;_2 -&#62; _5;&#10;_2 -&#62; _6;&#10;_2 -&#62; _7;&#10;_3 [label=&#34;go/build&#34; style=&#34;filled&#34; color=&#34;palegreen&#34;];&#10;_4 [label=&#34;log&#34; style=&#34;filled&#34; color=&#34;palegreen&#34;];&#10;_5 [label=&#34;os&#34; style=&#34;filled&#34; color=&#34;palegreen&#34;];&#10;_6 [label=&#34;sort&#34; style=&#34;filled&#34; color=&#34;palegreen&#34;];&#10;_7 [label=&#34;strings&#34; style=&#34;filled&#34; color=&#34;palegreen&#34;];&#10;}</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">godepgraph github.com/kisielk/godepgraph | dot -Tpng -o godepgraph.png</span><br></pre></td></tr></table></figure>
</div>

<img src="/images/go-tool/godepgraph.png">
</div>
</div>
<div id="outline-container-org888a227" class="outline-2">
<h2 id="org888a227"><a id="ID-ba02c35c-ca55-410d-8be6-985dd772ada6"></a><span class="section-number-2">16</span> go-callvis</h2>
<div class="outline-text-2" id="text-16">
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u github.com/TrueFurby/go-callvis</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go-callvis -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of go-callvis:
  -debug
      Enable verbose log.
  -focus string
      Focus package with name or import path. (default "main")
  -group string
      Grouping functions by [pkg, type] (separate multiple by comma).
  -ignore string
      Ignore package paths with prefix (separate multiple by comma).
  -limit string
      Limit package paths to prefix. (separate multiple by comma)
  -minlen uint
      Minimum edge length (for wider output). (default 2)
  -nodesep float
      Minimum space between two adjacent nodes in the same rank (for taller output). (default 0.35)
  -nostd
      Omit calls to/from std packages.
  -tests
      Include test code.
  -version
      Show version and exit.

</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go-callvis github.com/TrueFurby/go-callvis | dot -Tpng -o go-callvis.png</span><br></pre></td></tr></table></figure>
</div>

<img src="/images/go-tool/go-callvis.png">
</div>
</div>
<div id="outline-container-orge0f1ad6" class="outline-2">
<h2 id="orge0f1ad6"><a id="ID-92f86679-df70-43b9-9bd8-ff5f1938040a"></a><span class="section-number-2">17</span> depth</h2>
<div class="outline-text-2" id="text-17">
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u github.com/KyleBanks/depth/cmd/depth</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">depth -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of depth:
  -explain string
      If set, show which packages import the specified target
  -internal
      If set, resolves dependencies of internal (stdlib) packages.
  -json
      If set, outputs the depencies in JSON format.
  -max int
      Sets the maximum depth of dependencies to resolve.
  -test
      If set, resolves dependencies used for testing.
</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">depth github.com/KyleBanks/depth/cmd/depth</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
github.com/KyleBanks/depth/cmd/depth
  ├ encoding/json
  ├ flag
  ├ fmt
  ├ io
  ├ os
  ├ strings
  └ github.com/KyleBanks/depth
    ├ bytes
    ├ errors
    ├ go/build
    ├ os
    ├ path
    ├ sort
    └ strings
12 dependencies (11 internal, 1 external, 0 testing).
</pre>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">depth -internal strings</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
strings
  ├ errors
  ├ internal/cpu
  ├ io
    ├ errors
    └ sync
      ├ internal/race
        └ unsafe
      ├ runtime
        ├ runtime/internal/atomic
          └ unsafe
        ├ runtime/internal/sys
        └ unsafe
      ├ sync/atomic
        └ unsafe
      └ unsafe
  ├ unicode
  └ unicode/utf8
12 dependencies (12 internal, 0 external, 0 testing).
strings
  ├ errors
  ├ internal/cpu
  ├ io
  ├ unicode
  └ unicode/utf8
5 dependencies (5 internal, 0 external, 0 testing).
</pre>
</div>
</div>

<div id="outline-container-orgf185afe" class="outline-2">
<h2 id="orgf185afe"><a id="ID-cb85213d-12e5-4875-9378-7f6284c8e21f"></a><span class="section-number-2">18</span> interface</h2>
<div class="outline-text-2" id="text-18">
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -u -v mvdan.cc/interfacer</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">interfacer -h</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> single</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Empty() {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Closer <span class="keyword">interface</span> {</span><br><span class="line">  Close()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReadCloser <span class="keyword">interface</span> {</span><br><span class="line">  Closer</span><br><span class="line">  Read()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Basic(c Closer) {</span><br><span class="line">  c.Close()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> BasicWrong(rc ReadCloser) { <span class="comment">// WARN rc can be Closer</span></span><br><span class="line">  rc.Close()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> OtherWrong(s St) { <span class="comment">// WARN s can be Closer</span></span><br><span class="line">  s.Close()</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">interfacer simple.go</span><br></pre></td></tr></table></figure>
</div>

<p>
simple.go:24:19: undeclared name: St
</p>
</div>
</div>
<div id="outline-container-org98618a3" class="outline-2">
<h2 id="org98618a3"><a id="ID-5cd1b815-d8e8-4f74-90b2-812cd8003f86"></a><span class="section-number-2">19</span> safesql</h2>
<div class="outline-text-2" id="text-19">
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">go get -u github.com/stripe/safesql</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">safesql</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage: safesql [-q] [-v] package1 [package2 ...]
  -q	Only print on failure
  -v	Verbose mode
</pre>
</div>
</div>
<div id="outline-container-orgb88ac21" class="outline-2">
<h2 id="orgb88ac21"><a id="ID-ae9ef244-2d16-4543-9856-dbc4a51ff34b"></a><span class="section-number-2">20</span> aligncheck</h2>
<div class="outline-text-2" id="text-20">
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">go get github.com/opennota/check/cmd/aligncheck</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">aligncheck  github.com/astaxie/beego</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
github.com/astaxie/beego: config.go:33:6: struct Config could have size 520 (currently 552)
github.com/astaxie/beego: config.go:51:6: struct Listen could have size 120 (currently 152)
github.com/astaxie/beego: config.go:71:6: struct WebConfig could have size 264 (currently 288)
github.com/astaxie/beego: config.go:89:6: struct SessionConfig could have size 104 (currently 128)
github.com/astaxie/beego: controller.go:67:6: struct Controller could have size 224 (currently 232)
github.com/astaxie/beego: router.go:124:6: struct ControllerRegister could have size 168 (currently 176)
</pre>
</div>
</div>

<div id="outline-container-org9d74b7b" class="outline-2">
<h2 id="org9d74b7b"><a id="ID-f85130fb-b9a6-4fed-bc5e-b4f89dc4d956"></a><span class="section-number-2">21</span> structcheck</h2>
<div class="outline-text-2" id="text-21">
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">go get github.com/opennota/check/cmd/structcheck</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">structcheck -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of structcheck:
  -a	Count assignments only
  -e	Report exported fields
  -t	Load test files too
  -tags string
      Build tags
</pre>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">structcheck fmt</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
fmt: ~/.gvm/gos/go1.9/src/fmt/scan.go:169:2: fmt.ssave.nlIsEnd
fmt: ~/.gvm/gos/go1.9/src/fmt/scan.go:170:2: fmt.ssave.nlIsSpace
fmt: ~/.gvm/gos/go1.9/src/fmt/scan.go:171:2: fmt.ssave.argLimit
fmt: ~/.gvm/gos/go1.9/src/fmt/scan.go:172:2: fmt.ssave.limit
fmt: ~/.gvm/gos/go1.9/src/fmt/scan.go:173:2: fmt.ssave.maxWid
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:30:2: fmt.fmtFlags.zero
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:35:2: fmt.fmtFlags.plusV
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:36:2: fmt.fmtFlags.sharpV
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:25:2: fmt.fmtFlags.precPresent
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:27:2: fmt.fmtFlags.plus
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:29:2: fmt.fmtFlags.space
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:24:2: fmt.fmtFlags.widPresent
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:26:2: fmt.fmtFlags.minus
fmt: ~/.gvm/gos/go1.9/src/fmt/format.go:28:2: fmt.fmtFlags.sharp
</pre>
</div>
</div>

<div id="outline-container-org42f7f0a" class="outline-2">
<h2 id="org42f7f0a"><a id="ID-27ddf18f-120a-4ac5-bf45-3d578593daca"></a><span class="section-number-2">22</span> varcheck</h2>
<div class="outline-text-2" id="text-22">
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">go get github.com/opennota/check/cmd/varcheck</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">varcheck -h</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Usage of varcheck:
  -e	Report exported variables and constants
</pre>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">varcheck image/jpeg</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
image/jpeg: ~/.gvm/gos/go1.9/src/image/jpeg/reader.go:74:2: adobeTransformYCbCr
image/jpeg: ~/.gvm/gos/go1.9/src/image/jpeg/reader.go:75:2: adobeTransformYCbCrK
image/jpeg: ~/.gvm/gos/go1.9/src/image/jpeg/writer.go:54:2: quantIndexLuminance
image/jpeg: ~/.gvm/gos/go1.9/src/image/jpeg/writer.go:55:2: quantIndexChrominance
image/jpeg: ~/.gvm/gos/go1.9/src/image/jpeg/writer.go:91:2: huffIndexLuminanceDC
image/jpeg: ~/.gvm/gos/go1.9/src/image/jpeg/writer.go:92:2: huffIndexLuminanceAC
image/jpeg: ~/.gvm/gos/go1.9/src/image/jpeg/writer.go:93:2: huffIndexChrominanceDC
image/jpeg: ~/.gvm/gos/go1.9/src/image/jpeg/writer.go:94:2: huffIndexChrominanceAC
</pre>
</div>
</div>
<div id="outline-container-org6cd7ba8" class="outline-2">
<h2 id="org6cd7ba8"><a id="ID-5bab7aed-ffc6-41bc-a6b3-1ac0a3f38869"></a><span class="section-number-2">23</span> eg</h2>
<div class="outline-text-2" id="text-23">
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get golang.org/x/tools/cmd/eg</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> ExtendWith50000ns(t time.Time) time.Time {</span><br><span class="line">  <span class="keyword">return</span> t.Add(time.Duration(<span class="number">50000</span>))</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> template</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> before(t time.Time, d time.Duration) time.Time {</span><br><span class="line">  <span class="comment">// if already time.Duration, do not cast.</span></span><br><span class="line">  <span class="keyword">return</span> t.Add(time.Duration(d))</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> after(t time.Time, d time.Duration) time.Time {</span><br><span class="line">  <span class="keyword">return</span> t.Add(d * time.Nanosecond)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">eg -t T.template .</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> ExtendWith50000ns(t time.Time) time.Time {</span><br><span class="line">  <span class="keyword">return</span> t.Add(<span class="number">50000</span> * time.Nanosecond)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

Last Updated 2017-12-13 Wed 18:24.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="https://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 25.3.2 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 9.1.4)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/11/07/go-modify-tags/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/go-modify-tags/" itemprop="url">gomodifytags</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T00:00:00+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/技术积累/" itemprop="url" rel="index">
                    <span itemprop="name">技术积累</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/07/go-modify-tags/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/11/07/go-modify-tags/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            


<div id="outline-container-org24b6d06" class="outline-2">
<h2 id="org24b6d06"><a id="ID-27719462-7684-42eb-a615-d34c2696f4b2"></a><span class="section-number-2">1</span> StructTag</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() {</span><br><span class="line">  tag := reflect.StructTag(<span class="string">`species:"gopher" color:"blue"`</span>)</span><br><span class="line">  fmt.Println(tag.Get(<span class="string">"color"</span>), tag.Get(<span class="string">"species"</span>))</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
blue gopher

</pre>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">  <span class="string">"github.com/fatih/structtag"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() {</span><br><span class="line">  tag := <span class="string">`json:"foo,omitempty,string" xml:"foo"`</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// parse the tag</span></span><br><span class="line">  tags, err := structtag.Parse(<span class="typename">string</span>(tag))</span><br><span class="line">  <span class="keyword">if</span> err != <span class="constant">nil</span> {</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// iterate over all tags</span></span><br><span class="line">  <span class="keyword">for</span> _, t := <span class="keyword">range</span> tags.Tags() {</span><br><span class="line">    fmt.Printf(<span class="string">"tag: %+v\n"</span>, t)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get a single tag</span></span><br><span class="line">  jsonTag, err := tags.Get(<span class="string">"json"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="constant">nil</span> {</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// change existing tag</span></span><br><span class="line">  jsonTag.Name = <span class="string">"foo_bar"</span></span><br><span class="line">  jsonTag.Options = <span class="constant">nil</span></span><br><span class="line">  tags.Set(jsonTag)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add new tag</span></span><br><span class="line">  tags.Set(&amp;structtag.Tag{</span><br><span class="line">    Key:     <span class="string">"hcl"</span>,</span><br><span class="line">    Name:    <span class="string">"foo"</span>,</span><br><span class="line">    Options: []<span class="typename">string</span>{<span class="string">"squash"</span>},</span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="comment">// print the tags</span></span><br><span class="line">  fmt.Println(tags) <span class="comment">// Output: json:"foo_bar" xml:"foo" hcl:"foo,squash"</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
tag: json:"foo,omitempty,string"
tag: xml:"foo"
json:"foo_bar" xml:"foo" hcl:"foo,squash"

</pre>
</div>
</div>

<div id="outline-container-org9966ce4" class="outline-2">
<h2 id="org9966ce4"><a id="ID-5680af25-d743-4316-a633-2328fc17afde"></a><span class="section-number-2">2</span> AST(抽象语法树)</h2>
<div class="outline-text-2" id="text-2">
<p>
遍历语法树，展示结构体字段列表：
</p>
<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"go/ast"</span></span><br><span class="line">  <span class="string">"go/parser"</span></span><br><span class="line">  <span class="string">"go/token"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() {</span><br><span class="line">  src := <span class="string">`package main</span><br><span class="line">        type Example struct {</span><br><span class="line">    Foo string`</span> + <span class="string">" `json:\"foo\"` }"</span></span><br><span class="line"></span><br><span class="line">  fset := token.NewFileSet()</span><br><span class="line">  file, err := parser.ParseFile(fset, <span class="string">"demo"</span>, src, parser.ParseComments)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="constant">nil</span> {</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  ast.Inspect(file, <span class="keyword">func</span>(x ast.Node) <span class="typename">bool</span> {</span><br><span class="line">    s, ok := x.(*ast.StructType)</span><br><span class="line">    <span class="keyword">if</span> !ok {</span><br><span class="line">      <span class="keyword">return</span> <span class="constant">true</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, field := <span class="keyword">range</span> s.Fields.List {</span><br><span class="line">      fmt.Printf(<span class="string">"Field: %s\n"</span>, field.Names[<span class="number">0</span>].Name)</span><br><span class="line">      fmt.Printf(<span class="string">"Tag:   %s\n"</span>, field.Tag.Value)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="constant">false</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<pre class="example">
Field: Foo
Tag:   `json:"foo"`

</pre>
</div>
</div>

<div id="outline-container-orgdf830f9" class="outline-2">
<h2 id="orgdf830f9"><a id="ID-4e24c993-d2b1-49d0-8e6c-33156a21989b"></a><span class="section-number-2">3</span> gomodifytags</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span></span><br><span class="line">  Port        <span class="typename">int</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span></span><br><span class="line">    Password <span class="typename">string</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>
</div>

<div id="outline-container-orge22bd54" class="outline-3">
<h3 id="orge22bd54"><a id="ID-55031635-8b27-40d7-a026-8e7edd885281"></a><span class="section-number-3">3.1</span> Struct based modification</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -add-tags json -w</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password"`</span></span><br><span class="line">  } <span class="string">`json:"credentials"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<p>
支持三种 <b>transform</b> , 如下所示：
</p>
<ul class="org-ul">
<li><code>snakecase</code>: &ldquo;BaseDomain&rdquo; -&gt; &ldquo;base_domain&rdquo;</li>
<li><code>camelcase</code>: &ldquo;BaseDomain&rdquo; -&gt; &ldquo;baseDomain&rdquo;</li>
<li><code>lispcase</code>: &ldquo;BaseDomain&rdquo; -&gt; &ldquo;base-domain&rdquo;</li>
</ul>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -add-tags xml -transform camelcase</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name" xml:"name"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port" xml:"port"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs" xml:"enableLogs"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain" xml:"baseDomain"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username" xml:"username"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password" xml:"password"`</span></span><br><span class="line">  } <span class="string">`json:"credentials" xml:"credentials"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -add-tags xml -transform camelcase</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name" xml:"name"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port" xml:"port"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs" xml:"enableLogs"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain" xml:"baseDomain"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username" xml:"username"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password" xml:"password"`</span></span><br><span class="line">  } <span class="string">`json:"credentials" xml:"credentials"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -add-tags validate:gt=1,scope:read-only</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name" validate:"gt=1" scope:"read-only"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port" validate:"gt=1" scope:"read-only"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs" validate:"gt=1" scope:"read-only"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain" validate:"gt=1" scope:"read-only"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username" validate:"gt=1" scope:"read-only"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password" validate:"gt=1" scope:"read-only"`</span></span><br><span class="line">  } <span class="string">`json:"credentials" validate:"gt=1" scope:"read-only"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -add-tags json --add-options json=omitempty -w</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name,omitempty"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port,omitempty"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs,omitempty"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain,omitempty"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username,omitempty"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password,omitempty"`</span></span><br><span class="line">  } <span class="string">`json:"credentials,omitempty"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -remove-tags json</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span></span><br><span class="line">  Port        <span class="typename">int</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span></span><br><span class="line">    Password <span class="typename">string</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -clear-tags</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span></span><br><span class="line">  Port        <span class="typename">int</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span></span><br><span class="line">    Password <span class="typename">string</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -remove-options json=omitempty</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password"`</span></span><br><span class="line">  } <span class="string">`json:"credentials"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -struct Server -clear-options</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password"`</span></span><br><span class="line">  } <span class="string">`json:"credentials"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-org6e1dd2f" class="outline-3">
<h3 id="org6e1dd2f"><a id="ID-fab400c7-942e-418d-b15f-89e9999cec8a"></a><span class="section-number-3">3.2</span> Line based modification</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -line 8,11 -clear-tags json</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name,omitempty"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port,omitempty"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs,omitempty"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain,omitempty"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span></span><br><span class="line">    Password <span class="typename">string</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -line 6,7 -remove-tags json</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name,omitempty"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port,omitempty"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username,omitempty"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password,omitempty"`</span></span><br><span class="line">  } <span class="string">`json:"credentials,omitempty"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -line 2,7 -add-tags bson</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name,omitempty" bson:"name"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port,omitempty" bson:"port"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs,omitempty" bson:"enable_logs"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain,omitempty" bson:"base_domain"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username,omitempty"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password,omitempty"`</span></span><br><span class="line">  } <span class="string">`json:"credentials,omitempty"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file demo.go -offset 100 -add-tags bson</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> {</span><br><span class="line">  Name        <span class="typename">string</span> <span class="string">`json:"name,omitempty" bson:"name"`</span></span><br><span class="line">  Port        <span class="typename">int</span>    <span class="string">`json:"port,omitempty" bson:"port"`</span></span><br><span class="line">  EnableLogs  <span class="typename">bool</span>   <span class="string">`json:"enable_logs,omitempty" bson:"enable_logs"`</span></span><br><span class="line">  BaseDomain  <span class="typename">string</span> <span class="string">`json:"base_domain,omitempty" bson:"base_domain"`</span></span><br><span class="line">  Credentials <span class="keyword">struct</span> {</span><br><span class="line">    Username <span class="typename">string</span> <span class="string">`json:"username,omitempty" bson:"username"`</span></span><br><span class="line">    Password <span class="typename">string</span> <span class="string">`json:"password,omitempty" bson:"password"`</span></span><br><span class="line">  } <span class="string">`json:"credentials,omitempty" bson:"credentials"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orgc635d7a" class="outline-3">
<h3 id="orgc635d7a"><a id="ID-2cd29cbf-09d0-4d03-911d-d50d1c87f49e"></a><span class="section-number-3">3.3</span> Shortcoming</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  First_name <span class="typename">string</span></span><br><span class="line">  Last_name  <span class="typename">string</span></span><br><span class="line">  addr       <span class="typename">string</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">gomodifytags -file user.go -struct User -add-tags json</span><br></pre></td></tr></table></figure>
</div>

<p>
期望得到的结果是： <code>first_name</code> ,但是却得到了 <code>first___name</code>, 同时 <code>addr</code> 字段不导出也生成了 <code>tag</code>, 如下所示：
</p>
<div class="org-src-container">
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  First_name <span class="typename">string</span> <span class="string">`json:"first___name"`</span></span><br><span class="line">  Last_name  <span class="typename">string</span> <span class="string">`json:"last___name"`</span></span><br><span class="line">  addr       <span class="typename">string</span> <span class="string">`json:"addr"`</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>
</div>

Last Updated 2017-11-09 Thu 15:00.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="https://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 24.5.1 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 9.1.2)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/10/31/literate-devOps/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/31/literate-devOps/" itemprop="url">org-babel有趣的事</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-31T00:00:00+08:00">
                2017-10-31
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/org-mode/" itemprop="url" rel="index">
                    <span itemprop="name">org-mode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/31/literate-devOps/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/10/31/literate-devOps/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            


<div id="outline-container-org23ec5dd" class="outline-2">
<h2 id="org23ec5dd"><a id="ID-971ec1fe-4655-44a8-bf63-812a49eea408"></a><span class="section-number-2">1</span> 数据格式化(:wrap)</h2>
<div class="outline-text-2" id="text-1">
</div>

<div id="outline-container-org9a3a29a" class="outline-3">
<h3 id="org9a3a29a"><a id="ID-0f26d666-d128-4e66-a635-f329a88b6650"></a><span class="section-number-3">1.1</span> json格式化</h3>
<div class="outline-text-3" id="text-1-1">
<pre class="example">
#+BEGIN_SRC sh :results code :wrap SRC js :exports both
  curl http://httpbin.org/get
#+END_SRC

#+RESULTS:
#+BEGIN_SRC js
{
  "args": {},
  "headers": {
    "Accept": "*/*",
    "Connection": "close",
    "Host": "httpbin.org",
    "User-Agent": "curl/7.47.0"
  },
  "origin": "180.167.20.58",
  "url": "http://httpbin.org/get"
}
#+END_SRC
</pre>
</div>
</div>

<div id="outline-container-org3d63782" class="outline-3">
<h3 id="org3d63782"><a id="ID-801b7ed8-d5c0-4a12-9d9b-c384dde9cf77"></a><span class="section-number-3">1.2</span> 其他格式化</h3>
<div class="outline-text-3" id="text-1-2">
<pre class="example">
#+BEGIN_SRC sh :wrap QUOTE :results raw :exports both
  date
#+END_SRC

#+RESULTS:
#+BEGIN_QUOTE
Fri Nov  3 23:05:34 CST 2017
#+END_QUOTE
</pre>
</div>
</div>
</div>

<div id="outline-container-org25baf69" class="outline-2">
<h2 id="org25baf69"><a id="ID-3760ee64-f27b-4b3a-9c51-489ba333bca2"></a><span class="section-number-2">2</span> 变量设置在Header中</h2>
<div class="outline-text-2" id="text-2">
<pre class="example">
** 变量设置在Header中
   :PROPERTIES:
   :ID:       d7b197d7-f925-47b7-bcc0-37e182761619
   :header-args:shell: :var host="google.com" :results pp :session brantou :exports both
   :END:
   #+BEGIN_SRC shell
     ping $host -c 2
   #+END_SRC

   #+RESULTS:
   :
   : $ PING google.com (192.168.83.230) 56(84) bytes of data.
   : 64 bytes from 192.168.83.230: icmp_seq=1 ttl=128 time=9.60 ms
   : 64 bytes from 192.168.83.230: icmp_seq=2 ttl=128 time=25.4 ms
   :
   : --- google.com ping statistics ---
   : packet loss, time 1001ms
   : rtt min/avg/max/mdev = 9.609/17.508/25.408/7.900 ms

   覆盖变量 *host* 和 *session* 置为空！
   #+BEGIN_SRC shell :var host="baidu.com" :session none
     ping $host -c 2
   #+END_SRC

   #+RESULTS:
   : PING baidu.com (111.13.101.208) 56(84) bytes of data.
   : 64 bytes from 111.13.101.208: icmp_seq=1 ttl=128 time=35.5 ms
   : 64 bytes from 111.13.101.208: icmp_seq=2 ttl=128 time=49.2 ms
   :
   : --- baidu.com ping statistics ---
   : 2 packets transmitted, 2 received, 0% packet loss, time 1002ms
   : rtt min/avg/max/mdev = 35.517/42.361/49.206/6.847 ms
</pre>
</div>
</div>

<div id="outline-container-org559b982" class="outline-2">
<h2 id="org559b982"><a id="ID-8d4ffdca-6c2c-49f2-b8a4-b94bdc0fe460"></a><span class="section-number-2">3</span> 结果的预处理(:post)</h2>
<div class="outline-text-2" id="text-3">
<pre class="example">
#+NAME: img_wrap
#+BEGIN_SRC python :var img_path="" :results output
  img_path=img_path.replace('[[file:..', '').replace(']]', '')
  print('&lt;img src="'+img_path+'" /&gt;')
#+END_SRC

#+HEADER: :file ../images/devOps/just-try-post.png :exports both
#+BEGIN_SRC plantuml :mkdirp yes :post img_wrap(img_path=*this*) :wrap EXPORT html
  @startuml
  cli -&gt; serv:  auth req
  serv --&gt; cli: auth res
  @enduml
#+END_SRC

#+RESULTS:
#+BEGIN_EXPORT html
&lt;img src="/images/devOps/just-try-post.png" /&gt;
#+END_EXPORT
</pre>
</div>
</div>
<div id="outline-container-org78c0e10" class="outline-2">
<h2 id="org78c0e10"><a id="ID-31ba7156-3ae9-410b-bd91-e93edb1b5046"></a><span class="section-number-2">4</span> noweb的引用(:noweb-ref)</h2>
<div class="outline-text-2" id="text-4">
<pre class="example">
#+HEADER: :tangle ../src/devOps/noweb_ref.sh :mkdirp yes
#+BEGIN_SRC shell :noweb yes :shebang #!/bin/sh
  &lt;&lt;fullest-disk&gt;&gt;
#+END_SRC

** the mount point of the fullest disk
   :PROPERTIES:
   :header-args:shell: :noweb-ref fullest-disk
   :END:

*** query all mounted disks
    #+BEGIN_SRC shell
        df \
    #+END_SRC
*** strip the header row
    #+BEGIN_SRC shell
        |sed '1d' \
    #+END_SRC
*** sort by the percent full
    #+BEGIN_SRC shell
        |awk '{print $5 " " $6}' | sort -n | tail -1 \
    #+END_SRC
*** extract the mount point
    #+BEGIN_SRC shell
      |awk '{print $2}'
    #+END_SRC
</pre>

<p>
tangle出的代码如下：
</p>
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#!/bin/sh&#10;df \&#10;|sed &#39;1d&#39; \&#10;|awk &#39;{print $5 &#34; &#34; $6}&#39; | sort -n | tail -1 \&#10;|awk &#39;{print $2}&#39;</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>
<div id="outline-container-org72086f3" class="outline-2">
<h2 id="org72086f3"><a id="ID-da1d2589-8df1-4eda-a480-46a06d84d7cd"></a><span class="section-number-2">5</span> 预处理/后置操作(:prologue/:epilogue)</h2>
<div class="outline-text-2" id="text-5">
<pre class="example">
在做相关操作时，可能需要预先初始化，同时又不想这些初始化过程出现在代码流程中，
这个时候你可使用 *:prologue* 来关联相关语句来达到预处理的效果。
#+NAME: prologue-example
#+BEGIN_SRC shell :prologue "echo yep; exit 0" :exports both
  echo "nope"
#+END_SRC

#+RESULTS: prologue-example
: yep

*:epilogue* 正好和 *:prologue* 完成的功能相反，用于后置处理，完成清理工作。
#+BEGIN_SRC shell :epilogue "exit 0; echo yep" :exports both
  echo "nope"
#+END_SRC

#+RESULTS:
: nope
</pre>
</div>
</div>

<div id="outline-container-orgc48d8ed" class="outline-2">
<h2 id="orgc48d8ed"><a id="ID-22c26ba6-18ba-4f00-961d-a1999dd868ba"></a><span class="section-number-2">6</span> 批量执行</h2>
<div class="outline-text-2" id="text-6">
<p>
可在命令行中调用代码块实现的函数，如下面所示：
</p>
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#!/bin/sh&#10;# -*- mode: shell-script -*-&#10;#&#10;# tangle files with org-mode&#10;#&#10;&#10;DIR=&#39;pwd&#39;&#10;FILES=&#34;&#34;&#10;# wrap each argument in the code required to call tangle on it&#10;for i in $@; do&#10;    FILES=&#34;$FILES \&#34;$i\&#34;&#34;&#10;done&#10;&#10;emacs -Q --batch \&#10;      --eval &#34;(progn&#10;(require &#39;org)(require &#39;ob)(require &#39;ob-tangle)&#10;(mapc (lambda (file)&#10;       (find-file (expand-file-name file \&#34;$DIR\&#34;))&#10;       (org-babel-tangle)&#10;       (kill-buffer)) &#39;($FILES)))&#34; 2&#62;&#38;1 | grep tangled</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-org5c2a921" class="outline-2">
<h2 id="org5c2a921"><a id="ID-a29fa69a-00f6-4b18-a776-c14295a76874"></a><span class="section-number-2">7</span> 连接mysql</h2>
<div class="outline-text-2" id="text-7">
<pre class="example">
#+BEGIN_SRC sql
  show tables;
#+END_SRC

#+RESULTS:
| Tables_in_mysql           |
|---------------------------|
| columns_priv              |
| db                        |
| engine_cost               |
| event                     |
| func                      |
| general_log               |
| gtid_executed             |
| help_category             |
| help_keyword              |
| help_relation             |
| help_topic                |
| innodb_index_stats        |
| innodb_table_stats        |
| ndb_binlog_index          |
| plugin                    |
| proc                      |
| procs_priv                |
| proxies_priv              |
| server_cost               |
| servers                   |
| slave_master_info         |
| slave_relay_log_info      |
| slave_worker_info         |
| slow_log                  |
| tables_priv               |
| time_zone                 |
| time_zone_leap_second     |
| time_zone_name            |
| time_zone_transition      |
| time_zone_transition_type |
| user                      |

#+BEGIN_SRC sql
  SELECT host, user FROM user WHERE 1;
#+END_SRC

#+RESULTS:
| host      | user             |
|-----------+------------------|
| %         | brantou          |
| localhost | debian-sys-maint |
| localhost | mysql.session    |
| localhost | mysql.sys        |
| localhost | root             |
</pre>
</div>
</div>

Last Updated 2017-12-05 Tue 23:20.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="https://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 24.5.1 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 9.1.3)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/08/30/ob-python-intro/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/30/ob-python-intro/" itemprop="url">写Python的新方式</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-30T00:00:00+08:00">
                2017-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/org-mode/" itemprop="url" rel="index">
                    <span itemprop="name">org-mode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/30/ob-python-intro/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/08/30/ob-python-intro/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            

<blockquote>
<p>
Org mode is for keeping notes, maintaining TODO lists, planning projects,
and authoring documents with a fast and effective plain-text system.
</p>
</blockquote>

<p>
<code>Org-mode</code> 类似于 <code>Markdown</code> , 但是远胜于 <code>Markdown</code> 。
曾有小伙伴说过， <code>Org-mode</code> 是 <code>Markdown</code> 的封神模式， 个人觉得这话一点不夸张，
相比较而言， <code>Markdown</code> 只是一套简洁的文档格式， 而 <code>Org-mode</code> 除了涵盖作为文档格式的简洁之外，
还可用于记笔记，维护 <b>TODO</b> 列表， 工程管理,以及可用于元编程。
对于元编程的支持请阅读我之前的译文， <a href="https://brantou.github.io/2017/04/01/babel-intro/">Babel: org-mode的元编程</a>。
</p>

<p>
所谓的元编程，即是 <code>Org-mode</code> 搭建了一个多语言可以交互执行的环境， 在这个环境中，可选用各语言的特性，来分解执行一个大型任务。
</p>

<img src="/images/babel-fish.jpg">
<blockquote>
<p>
The Babel Fish is small, yellow, and simultaneously translates from <br>
one spoken language to another.  <br>
– The Hitchhiker&rsquo;s Guide to the Galaxy, Douglas Adams
</p>
</blockquote>

<p>
<code>Org-mode</code> 对于比较流行的语言都有很好的支持，
而且对于新语言，也可以很容易添加支持，本人就给两种语言添加过支持。
本文章主要讲述 <code>Org-mode</code> 对于 <code>Python</code> 源代码块的支持,
<code>Python</code> 相当的流行, 所以在 <code>Org-mode</code> 中被很完美的支持。
<code>Org-mode</code> 中的 <code>Python</code> 源代码块可用于定义函数、过滤器和数据分析、创建图表以及生成可重现的研究论文。
</p>

<div id="outline-container-org4447609" class="outline-2">
<h2 id="org4447609"><a id="ID-dd1c7aab-e7a8-4c27-a12d-46fbe3f98cdb"></a><span class="section-number-2">1</span> 配置</h2>
<div class="outline-text-2" id="text-1">
<p>
这里假设 <code>Python</code>  的开发环境已配置完毕，若是还没配置，请自行google。
</p>

<p>
<code>Org-mode</code> 已内置在新的 <b>Emacs</b> 中，但是默认情况下， 只有 <code>emacs-lisp</code> 可被执行。
要启用或禁用其他语言, 可通过 <b>Emacs</b> 自定义交互界面来配置  <code>org-babel-load-languages</code> 变量,
或者将代码添加到 <code>init</code> 文件中, 启用python的代码如下所示:
</p>
<div class="org-src-container">
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">org-babel-do-load-languages</span></span><br><span class="line"> <span class="quoted">'org-babel-load-languages</span></span><br><span class="line"> <span class="quoted">'((python . <span class="literal">t</span>))</span>)</span></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orgf011755" class="outline-2">
<h2 id="orgf011755"><a id="ID-8b5e6e60-dddf-4813-8bfe-2ba85444f3ee"></a><span class="section-number-2">2</span> Org-mode对于Python源码块的支持</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orga4603d2" class="outline-3">
<h3 id="orga4603d2"><a id="ID-aaa9eaf4-7c30-48e2-a737-45fe5c77b7c5"></a><span class="section-number-3">2.1</span> 头参数</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org6f426f2" class="outline-4">
<h4 id="org6f426f2"><a id="ID-d1554529-76b0-41d1-b0eb-db13448dee88"></a><span class="section-number-4">2.1.1</span> 语言特定的头参数</h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>:results {output, value}: 默认 <code>value</code> 模式, 即 <i>functional mode</i>, 像函数一样执行，然后返回计算结果。</li>
<li>:preamble: 前导代码，插入到最前面（不常用）。 默认为空。</li>
<li>:return: 要返回的值（仅用于result-type为 <code>value</code> 时，不在 <code>session</code> 模式下;不常用）。
默认值为空，在 <code>Non-session</code> 模式下，使用 <code>return()</code> 返回值。</li>
<li>:python: 执行Python代码的程序名称。</li>
</ul>
</div>
</div>

<div id="outline-container-orgb133abd" class="outline-4">
<h4 id="orgb133abd"><a id="ID-ad484d0a-a8ae-4d72-800e-9a5a41ae3283"></a><span class="section-number-4">2.1.2</span> 公共头参数</h4>
<div class="outline-text-4" id="text-2-1-2">
<ul class="org-ul">
<li>:seesion [name]: 默认非 <code>session</code> 模式。</li>
<li>:var data=data-table: <code>Org-mode</code> 的 <code>table</code> 可被当做列表传递给Python代码块。</li>
<li>:exports {code, results, both, none}: 完全支持 <code>babel</code> 的导出选项。</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org709ba44" class="outline-3">
<h3 id="org709ba44"><a id="ID-1b1aa351-fb05-4fbe-bdc5-f55b93d38b79"></a><span class="section-number-3">2.2</span> Sessions</h3>
<div class="outline-text-3" id="text-2-2">
<p>
python完全支持 <code>session</code> 模式，包括命名 <code>session</code> 。
在 <code>session</code> 模式下，代码块都运行在同一个长时间运行的 <code>python</code> 的交互式解释器 <code>session</code> 中，就像你在交互式 <code>python</code> 键入的一样。
可以拥有多个 <code>session</code> ，而且它们是完全相互独立。
</p>

<p>
<code>session</code>  可用于定义函数，设置变量和在源块之间共享代码。
</p>

<p>
python中的 <code>session</code> 模式与 <code>non-session</code> 模式略有不同，因为在 <code>session</code> 模式下， 你正在与单个“交互式” <code>python session</code> 交互。
在 <code>python</code> 的交互模式中，空行是特殊的：它们表示缩进代码块的结束, 所以会写出一些稍微不同的 <code>python</code> 代码。
</p>

<p>
另外，在 <code>non-session</code> 模式下，python代码块将被包装在一个函数中， 所以要返回一个值（ <code>:result value mode</code> ），你必须使用一个return语句。
在 <code>session</code> 模式下， <code>python</code> 代码由解释器直接评估，而不是在一个函数的上下文中，
最后一个语句的值将被自动返回，因此不能使用 <code>return</code> 语句。
</p>
</div>

<div id="outline-container-org03da991" class="outline-4">
<h4 id="org03da991"><a id="ID-7e6dfa8c-70a2-402a-ae11-355ebd5b0c31"></a><span class="section-number-4">2.2.1</span> Session mode</h4>
<div class="outline-text-4" id="text-2-2-1">
<pre class="example">
# blank lines not OK in indented blocks, and don't use return()
# Source block is passed directly to interactive python;
# value is value of _ at end.
#+begin_src python :session
def foo(x):
  if x&gt;0:
    return x+1
  else:
    return x-1

foo(1)
#+end_src

#+RESULTS:
: 2
</pre>
</div>
</div>

<div id="outline-container-org8d8d698" class="outline-4">
<h4 id="org8d8d698"><a id="ID-0259c9cf-ebd7-431d-bd21-02f11ac76ca3"></a><span class="section-number-4">2.2.2</span> Non-session mode</h4>
<div class="outline-text-4" id="text-2-2-2">
<pre class="example">
# blank lines OK in indented blocks, and use return()
# Entire source block will get indented and used as the body of main()
#+begin_src python
def foo(x):
  if x&gt;0:
    return x+1

  else:
    return x-1

return foo(5)
#+end_src

#+RESULTS:
: 6
</pre>


<p>
最后，如果你使用 <code>matplotlib</code> 的图形功能，同时使用 <code>seesion</code> 模式，
必须显式设置后端, 例如 <b>PDF</b> , <b>PNG</b> 或其他文件导出后端。 见下面示例:
</p>
<pre class="example">
#+begin_src python :session :results file
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
fig=plt.figure(figsize=(3,2))
plt.plot([1,3,2])
fig.tight_layout()
plt.savefig('images/myfig.pdf')
'images/myfig.pdf' # return this to org-mode
#+end_src

#+RESULTS:
[[file:images/myfig.pdf]]
</pre>
</div>
</div>
</div>

<div id="outline-container-org9bdcd83" class="outline-3">
<h3 id="org9bdcd83"><a id="ID-499cadec-6fdf-4f0f-91e0-586ecb78bb70"></a><span class="section-number-3">2.3</span> 返回类型</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>value：=value= 结果是代码块中求值的最后一个表达式的值。 <code>session</code> 模式下使用的python解释器特殊变量“_” 来引用最后一个表达式的值。</li>
<li>output：=output= 结果来自 <code>python</code> 代码打印到 <code>stdout</code> 上任意信息。</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgfe6d677" class="outline-2">
<h2 id="orgfe6d677"><a id="ID-98d57d43-f1ad-40fe-bae1-9f248c41068e"></a><span class="section-number-2">3</span> 使用示例</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li><p>
Hello World!
</p>
<pre class="example">
#+begin_src python :results output
  print "Hello, world!"
#+end_src

#+RESULTS:
: Hello, world!
</pre></li>

<li><p>
参数
</p>
<pre class="example">
#+NAME: square
#+BEGIN_SRC python :var num=5
  def square(x):
      return x*x

  return square(num)
#+END_SRC

#+RESULTS: square
: 25

#+CALL: square(num=10)

#+RESULTS:
: 100
</pre></li>

<li><p>
文学编程
</p>
<pre class="example">

#+NAME: square
#+BEGIN_SRC python
  def square(x):
      return x*x
#+END_SRC

#+NAME: calc-square
#+BEGIN_SRC python :var num=5 :noweb strip-export :results output
  &lt;&lt;square&gt;&gt;
  print(square(num))
#+END_SRC

#+RESULTS: calc-square
: 25

#+CALL: calc-square(num=7)

#+RESULTS:
: 49

</pre></li>

<li><p>
内联调用(Inline calling):
</p>
<pre class="example">
2 加 2 等于 src_python{return(2+2)}
</pre>

<p>
当导出 <b>HTML</b> 或者 <b>LaTeX/PDF</b> 时，如下所示：
</p>
<pre class="example">
2 加 2 等于 4
</pre></li>

<li><p>
使用Org-mode的table作为参数
</p>
<pre class="example">
#+tblname: data_table
| a | 1 |
| b | 2 |
| c | 3 |
#+begin_src python :var val=1 :var data=data_table
# Return row specified by val.
# In non-session mode, use return to return results.
return(data[val])
#+end_src

#+RESULTS:
| b | 2 |
</pre></li>

<li><p>
绘图
</p>
<pre class="example">
#+begin_src python :results file
  import matplotlib, numpy
  matplotlib.use('Agg')
  import matplotlib.pyplot as plt
  fig=plt.figure(figsize=(4,2))
  x=numpy.linspace(-15,15)
  plt.plot(numpy.sin(x)/x)
  fig.tight_layout()
  plt.savefig('../images/python-matplot-fig.png')
  return '../images/python-matplot-fig.png'
#+end_src

#+RESULTS:
[[file:../images/python-matplot-fig.png]]
</pre>

<img src="/images/python-matplot-fig.png"></li>

<li><p>
词云
</p>
<pre class="example">

#+BEGIN_SRC python :preamble "# -*- coding: utf-8 -*-" :results value file
  import jieba.analyse
  from wordcloud import WordCloud, ImageColorGenerator
  import numpy as np
  from PIL import Image
  import random

  font_path = '../resource/tyzkaishu.ttf'
  width = 640
  height = 480

  text = open('../resource/xiyouji.txt').read()
  words = jieba.analyse.extract_tags(text, topK=200, withWeight=True)

  word_freqs = {}
  for word in words:
      word_freqs[word[0]] = word[1]

  mask = np.array(Image.open('../resource/stormtrooper_mask.png'))
  wordcloud = WordCloud(
      font_path=font_path, width=width, height=height,
      mask=mask).generate_from_frequencies(word_freqs)
  wordcloud.to_file('../images/xiyouji-mask.png')
  return '../images/xiyouji-mask.png'
#+END_SRC

#+RESULTS:
[[file:../images/xiyouji-mask.png]]

</pre>

<img src="/images/xiyouji-mask.png"></li>
</ul>
</div>
</div>

<div id="outline-container-org2bdd8ef" class="outline-2">
<h2 id="org2bdd8ef"><a id="ID-411b11c2-85b5-40ca-894b-c915ddb9325e"></a><span class="section-number-2">4</span> 前方预警</h2>
<div class="outline-text-2" id="text-4">
<p>
当把 <code>utf-8</code> 的字符串传给 <code>Python</code> , 需要格外小心。
</p>
</div>

<div id="outline-container-orga3916bb" class="outline-3">
<h3 id="orga3916bb"><a id="ID-005389e6-3af8-4987-a226-7d857f9fe35f"></a><span class="section-number-3">4.1</span> 传递utf-8字符串到Python</h3>
<div class="outline-text-3" id="text-4-1">
<pre class="example">
#+NAME: unicode_str
#+BEGIN_EXAMPLE
  “this string is not ascii!”
#+END_EXAMPLE

</pre>

<pre class="example">
#+NAME: error-in-passing-var
#+BEGIN_SRC python :var data=unicode_str
  return data
#+END_SRC

</pre>

<pre class="example">
#+RESULTS: error-in-passing-var

</pre>

<p>
上面代码不会生成任何输出, 并在 <code>*Org-Babel Error Output*</code> 的缓冲区中打印以下消息:
</p>
<blockquote>
<p>
File &ldquo;&lt;stdin&gt;&rdquo;, line 3
SyntaxError: Non-ASCII character &rsquo;\xe2&rsquo; in file &lt;stdin&gt; on line 3, but no encoding declared; see <a href="http://python.org/dev/peps/pep-0263/" rel="external nofollow noopener noreferrer" target="_blank">http://python.org/dev/peps/pep-0263/</a> for details
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org787b457" class="outline-3">
<h3 id="org787b457"><a id="ID-9e5a70ba-c852-4a19-8200-d20c395ab2af"></a><span class="section-number-3">4.2</span> 传递utf-8字符串到Python的变通方法</h3>
<div class="outline-text-3" id="text-4-2">
<p>
一个变通方法是使用 <code>:preamble</code> ,如下所示:
</p>
<pre class="example">
#+NAME: ok-in-passing-var
#+BEGIN_SRC python :preamble "# -*- coding: utf-8 -*-" :var data=unicode_str
  return data
#+END_SRC

</pre>

<pre class="example">
#+RESULTS: ok-in-passing-var
: “this string is not ascii!”

</pre>
</div>
</div>
</div>
<div id="outline-container-orgaaa780c" class="outline-2">
<h2 id="orgaaa780c"><a id="ID-86504328-89bc-461b-805b-ab7d0f252ad6"></a><span class="section-number-2">5</span> 参考文档</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li><a href="http://orgmode.org/worg/org-contrib/babel/languages/ob-doc-python.html" rel="external nofollow noopener noreferrer" target="_blank">Python Source Code Blocks in Org Mode</a></li>
<li><a href="https://brantou.github.io/2017/04/01/babel-intro/">Babel: org-mode的元编程</a></li>
<li><a href="https://brantou.github.io/2017/06/12/go-source-code-block-in-org/">在Org-mode中执行Go代码</a></li>
<li><a href="http://orgmode.org/manual/Working-With-Source-Code.html#Working-With-Source-Code" rel="external nofollow noopener noreferrer" target="_blank">Working with source code</a></li>
<li><a href="http://orgmode.org/worg/org-contrib/babel/" rel="external nofollow noopener noreferrer" target="_blank">Babel: active code in Org-mode</a></li>
</ul>
</div>
</div>

Last Updated 2017-08-31 Thu 22:25.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="https://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 24.5.1 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 9.1.2)

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      

      

    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400" alt="Brantou">
            
              <p class="site-author-name" itemprop="name">Brantou</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/brantou" target="_blank" title="GitHub" rel="external nofollow noopener noreferrer">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/brantou89" target="_blank" title="Twitter" rel="external nofollow noopener noreferrer">
                    
                      <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:brantou89@gmail.com" target="_blank" title="E-Mail" rel="external nofollow noopener noreferrer">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.jianshu.com/u/105d1cd5010c" target="_blank" title="Jianshu" rel="external nofollow noopener noreferrer">
                    
                      <i class="fa fa-fw fa-heartbeat"></i>Jianshu</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Brantou</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io" rel="external nofollow noopener noreferrer">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow noopener noreferrer">NexT.Pisces</a> v5.1.3</div>



  <div class="footer-custom">Hosted by <a target="_blank" href="https://pages.github.com" rel="external nofollow noopener noreferrer">GitHub Pages</a></div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	

		<script type="text/javascript">
		_hcwp = window._hcwp || [];

		_hcwp.push({widget:"Bloggerstream", widget_id: 89947, selector:".hc-comment-count", label: "{\%COUNT%\}" });

		

		(function() {
		if("HC_LOAD_INIT" in window)return;
		HC_LOAD_INIT = true;
		var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();
		var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
		hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/89947/"+lang+"/widget.js";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hcc, s.nextSibling);
		})();
		</script>

	
















  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
