<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">






<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">









  <meta name="baidu-site-verification" content="2NCO1zLkcL">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|monospace:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="tutorial,org-mode,babel,active-code,literate-programming,元编程,">





  <link rel="alternate" href="/atom.xml" title="Brantou的日常" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta name="description" content="原文Babel: Introduction, 由 Eric Schulte ,  Dan Davison, Tom Dye 编辑，维护。本文只做学习之用。




1 序言


Bable 可让许多不同的语言工作一起。
编程语言生活在自然语言的 Org-mode 文档的代码块之中。
一个数据片段可从一个表格传递给一个 Pythoh 代码块，然后可能再转移到一个 R 代码块，
最终以数据块被嵌入">
<meta property="og:type" content="article">
<meta property="og:title" content="Babel: org-mode的元编程">
<meta property="og:url" content="https://brantou.github.io/2017/04/01/babel-intro/index.html">
<meta property="og:site_name" content="Brantou的日常">
<meta property="og:description" content="原文Babel: Introduction, 由 Eric Schulte ,  Dan Davison, Tom Dye 编辑，维护。本文只做学习之用。




1 序言


Bable 可让许多不同的语言工作一起。
编程语言生活在自然语言的 Org-mode 文档的代码块之中。
一个数据片段可从一个表格传递给一个 Pythoh 代码块，然后可能再转移到一个 R 代码块，
最终以数据块被嵌入">
<meta property="og:image" content="http://orgmode.org/worg/images/babel/blue.png">
<meta property="og:image" content="https://raw.githubusercontent.com/brantou/hexo-blog/master/source/images/babel/dirs.png">
<meta property="og:image" content="http://orgmode.org/worg/images/babel/dot-emacs.png">
<meta property="og:updated_time" content="2017-07-10T03:46:44.763Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Babel: org-mode的元编程">
<meta name="twitter:description" content="原文Babel: Introduction, 由 Eric Schulte ,  Dan Davison, Tom Dye 编辑，维护。本文只做学习之用。




1 序言


Bable 可让许多不同的语言工作一起。
编程语言生活在自然语言的 Org-mode 文档的代码块之中。
一个数据片段可从一个表格传递给一个 Pythoh 代码块，然后可能再转移到一个 R 代码块，
最终以数据块被嵌入">
<meta name="twitter:image" content="http://orgmode.org/worg/images/babel/blue.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://brantou.github.io/2017/04/01/babel-intro/">





  <title>Babel: org-mode的元编程 | Brantou的日常</title>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-99654689-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a82c2fbb2a57e8b3c01e31a60807a7f6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Brantou的日常</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">二三事</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://brantou.github.io/2017/04/01/babel-intro/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brantou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brantou的日常">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Babel: org-mode的元编程</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-01T00:00:00+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/org-mode/" itemprop="url" rel="index">
                    <span itemprop="name">org-mode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/01/babel-intro/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/04/01/babel-intro/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        

<blockquote>
<p>
原文<a href="http://orgmode.org/worg/org-contrib/babel/intro.html" rel="external nofollow noopener noreferrer" target="_blank">Babel: Introduction</a>, 由 <b>Eric Schulte</b> ,  <b>Dan Davison</b>, <b>Tom Dye</b> 编辑，维护。本文只做学习之用。
</p>
</blockquote>

<div id="outline-container-org007914f" class="outline-2">
<h2 id="introduction"><a id="org007914f"></a><a id="ID-bee7e406-bb22-498e-a068-f0402cde93d0"></a><span class="section-number-2">1</span> 序言</h2>
<div class="outline-text-2" id="text-introduction">
<p>
<b>Bable</b> 可让许多不同的语言工作一起。
编程语言生活在自然语言的 <code>Org-mode</code> 文档的代码块之中。
一个数据片段可从一个表格传递给一个 <code>Pythoh</code> 代码块，然后可能再转移到一个 <code>R</code> 代码块，
最终以数据块被嵌入段落的中间而终结，或者通过 <code>gnuplot</code> 代码块生成图片嵌入在文档中。
</p>

<p>
通过扩展 <a href="http://orgmode.org/" rel="external nofollow noopener noreferrer" target="_blank">Org-mode</a>, 使其具有编辑,导出和执行源代码的功能, <b>Babel</b> 将 <code>Org-mode</code> 变成了文学编程和可重复性研究的工具。
</p>

<p>
<b>Babel</b> 通过提供以下特性来增强 <a href="http://orgmode.org/manual/Literal-examples.html" rel="external nofollow noopener noreferrer" target="_blank">Org-mode对代码代码块的支持</a>:
Babel augments Org-mode support for code blocks by providing:
</p>

<ul class="org-ul">
<li>代码块的交互和执行结果导出</li>
<li>代码块可像函数一样可参数化，引用其他代码块，可被远程调用</li>
<li>拼接，导出源代码到文件支持文学编程。</li>
</ul>

<a id="more"></a>
</div>
</div>

<div id="outline-container-org59d9014" class="outline-2">
<h2 id="org59d9014"><a id="ID-108e87f7-8457-4e8f-bf8d-daaf10f80462"></a><span class="section-number-2">2</span> 概述</h2>
<div class="outline-text-2" id="text-2">
<p>
<b>Babel</b> 在几个不同的方面提供了新的功能，不同的人可能想在不同的地方开始。
</p>

<dl class="org-dl">
<dt>在 <code>Org-mode</code> 中使用代码块</dt><dd>如果目前你还不知道怎么在 <code>Org-mode</code> 中创建代码块，
或者不清楚怎样在 <code>Org-mode</code> 的缓冲区和语言主模式编辑缓冲区(the language major-mode edit buffer)之间切换，
那么你需要应该看看<a href="http://orgmode.org/manual/Literal-examples.html" rel="external nofollow noopener noreferrer" target="_blank">Org 手册</a>中的相关部分 和 <a href="#source-code-blocks-org">下面的代码块章节</a>, 尝试下，然后赶紧回来。</dd>
<dt>执行代码</dt><dd><b>Babel</b> 的核心是能够在 <code>Org-mode</code> 代码块中执行代码，
从其他块和表格获取输入，并输出到更多的块和表。 从<a href="#source-code-execution">源代码执行</a>开始描述。</dd>
<dt>Literate Programming</dt><dd>程序员编写的代码，通常以其他方式执行（例如从命令行或将其引入到交互式会话中），
那么对 <b>Babel</b> 的简单介绍就是将代码放在 <code>Org-mode</code> 文件的代码块中，
然后使用 <b>Babel</b> 的 <code>Literate Programming</code> 支持从 <code>Org-mode</code> 文件中扩展提取源代码。</dd>
</dl>

<p>
所有这些用例以及 <b>Babel</b> 功能的详尽文档都被涵盖在 <b>Org</b> 手册的<a href="http://orgmode.org/manual/Working-With-Source-Code.html#Working-With-Source-Code" rel="external nofollow noopener noreferrer" target="_blank"> 使用源代码</a>中。
</p>
</div>
</div>

<div id="outline-container-orgfffa50e" class="outline-2">
<h2 id="getting-started"><a id="orgfffa50e"></a><a id="ID-ea65f564-0fc1-45ec-9f01-91125d57560a"></a><span class="section-number-2">3</span> 初始配置</h2>
<div class="outline-text-2" id="text-getting-started">
<blockquote>
<p>
If you have a working Emacs installation, then getting started with
Babel is a simple process.
</p>

<ol class="org-ol">
<li>If you are running Emacs24 a current version of Org-mode with
Babel is already available by default.  Otherwise, it is strongly
recommended that you update to the latest version of Org-mode by
<a href="http://orgmode.org/worg/org-faq.html#keeping-current-with-Org-mode-development" rel="external nofollow noopener noreferrer" target="_blank">keeping current with Org-mode development</a>.  As of Org-mode 7.0,
Babel is included as part of Org-mode.</li>

<li>Optionally activate the subset of languages that you will want
to execute with Babel.  See Configure active languages
instructions.  Emacs Lisp is activated by default so this step
can be skipped for now and all <code>emacs-lisp</code> examples will still
work as expected.</li>

<li>If you have made any changes don&rsquo;t forget to evaluate your
modified .emacs.</li>
</ol>
</blockquote>
</div>
</div>

<div id="outline-container-orga610931" class="outline-2">
<h2 id="source-code-blocks"><a id="orga610931"></a><a id="ID-93f23ca9-fef1-4ebe-ae1f-3d68fddd9ea6"></a><span class="section-number-2">4</span> 代码块</h2>
<div class="outline-text-2" id="text-source-code-blocks">
</div>
<div id="outline-container-org2e808ef" class="outline-3">
<h3 id="source-code-blocks-org"><a id="org2e808ef"></a><a id="ID-63128e9d-e315-491b-b4eb-cd15aec54a69"></a><span class="section-number-3">4.1</span> 代码块在 <code>Org-mode</code> 中</h3>
<div class="outline-text-3" id="text-source-code-blocks-org">
<p>
<b>Babel</b> 是关于 <code>Org-mode</code> 中代码块的。 如果还不熟悉 <code>Org-mode</code> 中的代码块的概念，请在继续之前查看 <a href="http://orgmode.org/manual/Literal-examples.html" rel="external nofollow noopener noreferrer" target="_blank">Org-mode手册的相关章节</a>。
</p>

<p>
受到支持语言的代码块可以出现在 <code>Org-mode</code> 文件的任意位置。
代码块可以直接在 <code>Org-mode</code> 文件中编辑，但通过 <code>C-c '</code> 调用的函数 <code>org-edit-src-code</code> 编辑代码往往更容易。
将代码块放全新的缓冲区中，同时激活相应语言的模式,语言的编辑特性你全都可用，真是爽。
</p>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#+begin_src language org-switches&#10;,body&#10;#+end_src</span><br></pre></td></tr></table></figure>
</div>

<p>
<code>ruby</code> 代码的代码块如下所示:
</p>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#+begin_src ruby&#10;,require &#39;date&#39;&#10;,&#34;This file was last evaluated on #{Date.today}&#34;&#10;#+end_src</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-org97a4e6d" class="outline-3">
<h3 id="source-code-blocks-babel"><a id="org97a4e6d"></a><a id="ID-780f1b68-48ce-4786-88b9-10b1a1b10234"></a><span class="section-number-3">4.2</span> 代码块在 <code>Babel</code> 中</h3>
<div class="outline-text-3" id="text-source-code-blocks-babel">
<p>
<b>Babel</b> 向代码块添加了一些新的元素。 基本结构变成了:
</p>

<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#+begin_src language  org-switches header-arguments&#10;,body&#10;#+end_src</span><br></pre></td></tr></table></figure>
</div>

<dl class="org-dl">
<dt>language</dt><dd>代码块中代码的语言标示。 有效值必须是 <code>org-babel-interpreters</code> 的成员。</dd>
<dt>header-arguments</dt><dd><code>header-arguments</code> 控制源代码块的执行和输出的许多方面。</dd>
</dl>
<p>
请参阅<a href="http://orgmode.org/manual/Header-arguments.html#Header-arguments" rel="external nofollow noopener noreferrer" target="_blank">Header Arguments</a>部分，以查看可用的 <code>header-arguments=</code> 。
</p>
<dl class="org-dl">
<dt>body</dt><dd>等待被执行的源代码。 一个重要的键绑定 <code>C-c '</code> , 调用 <code>org-edit-src-code</code> ，打开一个包含适合于该语言 <code>major mode</code> 的编辑缓冲区。</dd>
</dl>
<p>
然后你就可以像往常在emacs编辑代码那样来编辑你的代码块。
</p>
</div>
</div>
</div>

<div id="outline-container-org9919787" class="outline-2">
<h2 id="source-code-execution"><a id="org9919787"></a><a id="ID-633c29ed-bc53-4bf2-8c22-fca5847eddf0"></a><span class="section-number-2">5</span> 源代码执行</h2>
<div class="outline-text-2" id="text-source-code-execution">
<p>
<b>Babel</b> 通过将代码传递给解释器来执行解释语言（如shell，python，R等）的代码块。 在执行结果上可以做进一步的操作，如果你想的话。
</p>
</div>

<div id="outline-container-orgc67246c" class="outline-3">
<h3 id="orgc67246c"><a id="ID-cbc64bd5-950a-4d6d-a659-8acedede1e8d"></a><span class="section-number-3">5.1</span> 示例</h3>
<div class="outline-text-3" id="text-5-1">
<p>
以下是三种不同语言的代码块，其后是其输出。
如果正在Emacs中查看本文档的 <code>Org-mode</code> 版本，则把光标放置在块的任何位置，然后按 <code>C-c C-c</code> 执行代码<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>（并随意更改它）。
</p>
</div>
<div id="outline-container-org9ec4272" class="outline-4">
<h4 id="org9ec4272"><a id="ID-9ff0080c-2a4e-42de-bb80-f0ff0df537f3"></a><span class="section-number-4">5.1.1</span> Ruby</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
在 <code>Org-mode</code> 的文件中:
</p>
<pre class="example">
#+begin_src ruby
require 'date'
"This file was last evaluated on #{Date.today}"
#+end_src

</pre>

<p>
HTML 导出的代码:
</p>
<div class="org-src-container">
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'date'</span></span><br><span class="line"><span class="string">"This file was last evaluated on <span class="subst">#{<span class="constant">Date</span>.today}</span>"</span></span><br></pre></td></tr></table></figure>
</div>

<p>
HTML 导出的执行结果:
</p>
<pre class="example">
This file was last evaluated on 2017-04-05

</pre>
</div>
</div>

<div id="outline-container-org7d933f1" class="outline-4">
<h4 id="org7d933f1"><a id="ID-342ff42e-dab6-4ecf-a0d1-fc0b922b5329"></a><span class="section-number-4">5.1.2</span> Shell</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
在 <code>Org-mode</code> 的文件中:
</p>
<pre class="example">
#+begin_src sh
  echo "This file takes up `du -h babel-intro.org |sed 's/\([0-9k]*\)[ ]*babel-intro.org/\1/'`"
#+end_src

</pre>

<p>
HTML 导出的代码:
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"This file takes up `du -h babel-intro.org |sed 's/\([0-9k]*\)[ ]*babel-intro.org/\1/'`"</span></span><br></pre></td></tr></table></figure>
</div>

<p>
HTML 导出的执行结构:
</p>
<pre class="example">
This file takes up 36K

</pre>
</div>
</div>

<div id="outline-container-org65b8c1f" class="outline-4">
<h4 id="org65b8c1f"><a id="ID-57448a04-6850-40ac-a1ca-1f7dedcd5942"></a><span class="section-number-4">5.1.3</span> <a href="http://www.r-project.org/" rel="external nofollow noopener noreferrer" target="_blank">R</a></h4>
<div class="outline-text-4" id="text-5-1-3">
<p>
当前这个文件中最常用的词是？
在 <code>Org-mode</code> 文件中:
</p>
<pre class="example">
#+begin_src R :colnames yes
  words &lt;- tolower(scan("babel-intro.org", what="", na.strings=c("|",":")))
  t(sort(table(words[nchar(words) &gt; 3]), decreasing=TRUE)[1:10])
#+end_src

</pre>

<p>
HTML 导出的代码:
</p>
<div class="org-src-container">
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">words &amp;lt;- tolower(scan(<span class="string">"babel-intro.org"</span>, what=<span class="string">""</span>, na.strings=c(<span class="string">"|"</span>,<span class="string">":"</span>)))</span><br><span class="line">t(sort(table(words[nchar(words) &amp;gt; <span class="number">3</span>]), decreasing=<span class="literal">TRUE</span>)[<span class="number">1</span>:<span class="number">10</span>])</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-org28e2dc0" class="outline-4">
<h4 id="org28e2dc0"><a id="ID-d3053d37-0c93-41ab-946f-56c3407e1193"></a><span class="section-number-4">5.1.4</span> <a href="http://ditaa.sourceforge.net/" rel="external nofollow noopener noreferrer" target="_blank">ditaa</a></h4>
<div class="outline-text-4" id="text-5-1-4">
<p>
在 <code>Org-mode</code> 文件中:
</p>
<pre class="example">
#+begin_src ditaa :file blue.png :cmdline -r
+---------+
| cBLU    |
|         |
|    +----+
|    |cPNK|
|    |    |
+----+----+
#+end_src

</pre>

<p>
HTML导出的代码:
</p>
<div class="org-src-container">
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">+---------+&#10;| cBLU    |&#10;|         |&#10;|    +----+&#10;|    |cPNK|&#10;|    |    |&#10;+----+----+</span><br></pre></td></tr></table></figure>
</div>

<p>
HTML导出的结果图:
</p>

<div class="figure">
<p><img src="http://orgmode.org/worg/images/babel/blue.png" alt="blue.png">
</p>
</div>
</div>
</div>

<div id="outline-container-org4d050cb" class="outline-4">
<h4 id="org4d050cb"><a id="ID-141de388-4141-4e02-ac15-9268a0480ca5"></a><span class="section-number-4">5.1.5</span> js</h4>
<div class="outline-text-4" id="text-5-1-5">
<div class="org-src-container">
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'Hello, world'</span>);</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd4dbdf1" class="outline-3">
<h3 id="results"><a id="orgd4dbdf1"></a><a id="ID-c0705d07-4dd6-418b-bd6b-4aa9dd920a1e"></a><span class="section-number-3">5.2</span> 捕获代码执行结果</h3>
<div class="outline-text-3" id="text-results">
<p>
<b>Babel</b> 提供了两种根本不同的模式来捕获代码执行的结果： <i>functional mode</i> 和 <i>scripting mode</i> 。 模式的选择可以通过配置 <code>:results</code> 头参数来指定。
</p>
</div>
<div id="outline-container-orge8d43f4" class="outline-4">
<h4 id="results-value"><a id="orge8d43f4"></a><a id="ID-f5a3fb97-8add-4f5a-b5ed-c60507bf4b49"></a><span class="section-number-4">5.2.1</span> <code>:results value</code> (functional mode)</h4>
<div class="outline-text-4" id="text-results-value">
<p>
代码执行的结果是代码块中最后一个语句的值。
在 <i>functional mode</i> 下，代码块是具有返回值的函数。 一个代码块的返回值可以用作另一代码块的输入，即使是不同语言的输入。
这样的话，Babel成为一种<a href="http://orgmode.org/worg/org-contrib/babel/intro.html#meta-programming-language" rel="external nofollow noopener noreferrer" target="_blank">元编程语言</a>。 如果块返回表格数据（某种类型的向量，数组或表），那么将可以作为 <code>Org-mode</code> 的表格保存在缓冲区中。
<i>functional mode</i> 是默认设置。
</p>

<p>
作为示例，观察以下python代码块及其输出。
</p>
<div class="org-src-container">
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">print(<span class="string">"Hello, today's date is %s"</span> % time.ctime())</span><br><span class="line">print(<span class="string">"Two plus two is"</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span> + <span class="number">2</span></span><br></pre></td></tr></table></figure>
</div>

<p>
请注意，在 <i>functional mode</i> 下，输出只由最后一个语句返回，没有其他情况。
</p>
</div>
</div>

<div id="outline-container-org6f1a339" class="outline-4">
<h4 id="results-output"><a id="org6f1a339"></a><a id="ID-c9b10b0a-2b42-41ab-a84d-4c6aeaba0047"></a><span class="section-number-4">5.2.2</span> <code>:results output</code> (scripting mode)</h4>
<div class="outline-text-4" id="text-results-output">
<p>
在 <i>scripting mode</i> 中，Babel捕获代码块的文本输出并将其放置在 <code>Org-mode</code> 的缓冲区中。
它被称为 <i>scripting mode</i> ，因为代码块包含一系列命令，并返回每个命令的输出。
与功能模式不同，代码块本身除了其包含的命令的输出之外没有返回值。<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>
</p>

<p>
观察以下使用 <i>scripting mode</i> 执行代码块的结果。
</p>
<div class="org-src-container">
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">print(<span class="string">"Hello, today's date is %s"</span> % time.ctime())</span><br><span class="line">print(<span class="string">'Two plus two is'</span>)</span><br><span class="line"><span class="number">2</span> + <span class="number">2</span></span><br></pre></td></tr></table></figure>
</div>

<p>
在这里， <i>scripting mode</i> 返回了python写到 <code>stdout</code> 的文本。
因为代码块不包含最后一个语句 <code>(2 + 2)</code> 的 <code>print()</code> 语句，所以结果中不会出现4。
</p>
</div>
</div>
</div>

<div id="outline-container-orgb59e5f1" class="outline-3">
<h3 id="orgb59e5f1"><a id="ID-245a812f-594f-4e6e-b795-92824297b5e3"></a><span class="section-number-3">5.3</span> 基于会话的代码块</h3>
<div class="outline-text-3" id="text-5-3">
<p>
对于某些语言，例如Python，R，ruby和shell，可以在Emacs中运行一个不完备的交互式会话进程。
这意味着创建了一个不同源代码块之间共享数据对象的持久化环境。
<b>Babel</b> 支持使用 <code>:session</code> 头参数来 指定代码块运行于特定会话中。
如果头参数被赋予一个值，那么该参数将被用作会话的名称。
因此，可以并发的在不同的会话中运行同一语言的不同代码块。
</p>

<p>
基于特定会话的代码块对于原型设计和调试特别有用。 函数 <code>org-babel-pop-to-session</code> 可用于切换会话缓冲区。
</p>

<p>
一旦代码块编辑完成，通常最好在会话之外执行它，因为这样它执行的环境将是确定的。
</p>

<blockquote>
<p>
With R, the session will be under the control of <a href="http://ess.r-project.org/" rel="external nofollow noopener noreferrer" target="_blank">Emacs Speaks Statistics</a> as usual,
and the full power of ESS is thus still available,
both in the R session, and when switching to the R code edit buffer with <code>​C-c '​</code>.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgcbd41e7" class="outline-3">
<h3 id="arguments-to-source-code-blocks"><a id="orgcbd41e7"></a><a id="ID-1a103aeb-0eea-4e60-b882-346604ff4537"></a><span class="section-number-3">5.4</span> 代码块的入参</h3>
<div class="outline-text-3" id="text-arguments-to-source-code-blocks">
<p>
<b>Babel</b> 支持代码块的参数化，即可以将参数传递给代码块，从而使它们函数化。
<i>functional mode</i> 和 <i>scripting mode</i> 都支持入参。
</p>
</div>

<div id="outline-container-orge296088" class="outline-4">
<h4 id="using-a-code-block-as-a-function"><a id="orge296088"></a><a id="ID-479c571b-254e-403e-963e-a8185ce792d2"></a><span class="section-number-4">5.4.1</span> 代码块作为函数的简单示例</h4>
<div class="outline-text-4" id="text-using-a-code-block-as-a-function">
<p>
首先我们来看一个非常简单的例子。 以下源代码块使用Python定义了一个函数，求入参的平方。
</p>

<div class="org-src-container">
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> x*x</span><br></pre></td></tr></table></figure>
</div>

<p>
在 Org-mode 文件中, 函数定义如下:
</p>
<pre class="example">
#+name: square
#+header: :var x=0
#+begin_src python
return x*x
#+end_src

</pre>


<p>
调用函数如下:
</p>
<pre class="example">
#+call: square(x=6,y=8)

</pre>

<p>
(<i>对于</i> <code>call</code> <i>语法细节请参阅</i> <a href="http://orgmode.org/worg/org-contrib/babel/intro.html#library-of-babel" rel="external nofollow noopener noreferrer" target="_blank">Library of Babel</a>)
</p>

<pre class="example">
36

</pre>
</div>
</div>

<div id="outline-container-org4806d45" class="outline-4">
<h4 id="org4806d45"><a id="ID-192b07cb-0c73-4af0-a476-b40e86b822da"></a><span class="section-number-4">5.4.2</span> <code>Org-mode</code> 表格作为入参的更复杂的示例</h4>
<div class="outline-text-4" id="text-5-4-2">
<p>
在本例中，使用Emacs Lisp定义的一个名为 <code>fibonacci-seq</code> 的函数。
函数 <code>fibonacci-seq</code> 计算斐波纳契序列。 该函数只需要一个参数，在当前情况下参数即为 <code>Org-mode</code> 表格的引用。
</p>

<p>
下面即为传递给 <code>fibonacci-seq</code> 的 <code>Org-mode</code> 表格:
</p>
<table id="orgd9990c0" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-right">

<col class="org-right">

<col class="org-right">

<col class="org-right">

<col class="org-right">

<col class="org-right">

<col class="org-right">

<col class="org-right">

<col class="org-right">

<col class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
<td class="org-right">9</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
<td class="org-right">8</td>
<td class="org-right">10</td>
<td class="org-right">12</td>
<td class="org-right">14</td>
<td class="org-right">16</td>
<td class="org-right">18</td>
<td class="org-right">20</td>
</tr>
</tbody>
</table>

<p>
表格在 <code>Org-mode</code> 的缓冲区中如下所示：
</p>
<pre class="example">
#+tblname: fibonacci-inputs
| 1 | 2 | 3 | 4 |  5 |  6 |  7 |  8 |  9 | 10 |
| 2 | 4 | 6 | 8 | 10 | 12 | 14 | 16 | 18 | 20 |

</pre>

<p>
Emacs Lisp的源代码:
</p>
<div class="org-src-container">
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">defun</span> fibonacci <span class="list">(<span class="keyword">n</span>)</span></span><br><span class="line"><span class="list">(<span class="keyword">if</span> <span class="list">(<span class="keyword">or</span> <span class="list">(<span class="keyword">=</span> n <span class="number">0</span>)</span> <span class="list">(<span class="keyword">=</span> n <span class="number">1</span>)</span>)</span></span><br><span class="line">    n</span><br><span class="line">  <span class="list">(<span class="keyword">+</span> <span class="list">(<span class="keyword">fibonacci</span> <span class="list">(<span class="keyword">-</span> n <span class="number">1</span>)</span>)</span> <span class="list">(<span class="keyword">fibonacci</span> <span class="list">(<span class="keyword">-</span> n <span class="number">2</span>)</span>)</span>)</span>)</span>)</span></span><br><span class="line">  <span class="list">(<span class="keyword">mapcar</span> <span class="list">(<span class="keyword">lambda</span> <span class="list">(<span class="keyword">row</span>)</span></span><br><span class="line">        <span class="list">(<span class="keyword">mapcar</span> <span class="quoted">#'fibonacci</span> row)</span>)</span> fib-inputs)</span></span><br></pre></td></tr></table></figure>
</div>

<p>
在 <code>Org-mode</code> 中函数如下所示:
</p>
<pre class="example">
#+name: fibonacci-seq
#+begin_src emacs-lisp :var fib-inputs=fibonacci-inputs
  (defun fibonacci (n)
    (if (or (= n 0) (= n 1))
        n
      (+ (fibonacci (- n 1)) (fibonacci (- n 2)))))

  (mapcar (lambda (row)
            (mapcar #'fibonacci row)) fib-inputs)
#+end_src

</pre>

<p>
<code>fibonacci-seq</code> 的返回值，也是一个表格:
</p>
</div>
</div>
</div>
<div id="outline-container-org1c8ca5a" class="outline-3">
<h3 id="org1c8ca5a"><a id="ID-45f36f3c-0268-45ee-96cd-ea23cf4482d3"></a><span class="section-number-3">5.5</span> 内联(In-line)的代码块</h3>
<div class="outline-text-3" id="text-5-5">
<p>
可使用以下语法内联(In-line)的执行代码：
</p>

<pre class="example">
Without header args: src_lang{code} or with header args: src_lang[args]{code},
for example src_python[:session]{10*x}, where x is a variable existing in the
python session.

</pre>

<p>
代码如下:
</p>
<pre class="example">
src_python{return "Hello World!"}

</pre>

<p>
执行结果： <code>Hello World!</code>
</p>
</div>
</div>

<div id="outline-container-org6a9bbfa" class="outline-3">
<h3 id="org6a9bbfa"><a id="ID-f4809ee0-f691-4c33-853f-423fcd7c2571"></a><span class="section-number-3">5.6</span> 代码块扩展</h3>
<div class="outline-text-3" id="text-5-6">
<p>
<b>Babel</b> 在执行之前“扩展”代码块，即，执行代码包括把引用的数据(或代码)填充到代码块内容里。
可以预览展开的内容，还可以在 <i>tangling</i> 期间展开代码。 扩展时，头参数和变量需要一并考虑进去。
</p>

<dl class="org-dl">
<dt>preview</dt><dd><code>C-c M-b p</code> (<code>C-c C-v v</code>) 关联到 <code>org-babel-expand-src-block</code> 函数。它可用于在代码块中预览扩展的内容, 对调试很有用。</dd>

<dt>tangling</dt><dd>扩展的的代码块可以被 <i>tangled</i> 。 <i>tangling</i> 可能包括的变量值
<ul class="org-ul">
<li>其他代码的执行结果，</li>
<li>存储在标题属性中变量，或者</li>
<li>表格。</li>
</ul></dd>
</dl>

<p>
<i>tangling</i> 扩展代码块的一个可能用途是用于emacs初始化。
用户名和密码等值可以存储在标题属性或表格中。
可以使用 <code>:no-expand</code> 头参数来阻止 <i>tangling</i> 期间代码块的扩展。
</p>

<p>
下面是代码块及其生成的扩展的示例。
</p>

<p>
数据被存储在表格中:
</p>
<table id="org665e12d" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">username</td>
<td class="org-left">john-doe</td>
</tr>

<tr>
<td class="org-left">password</td>
<td class="org-left">abc123</td>
</tr>
</tbody>
</table>

<p>
引用数据表格的代码块:
</p>
<div class="org-src-container">
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">setq</span> my-special-username <span class="list">(<span class="keyword">first</span> <span class="list">(<span class="keyword">first</span> data)</span>)</span>)</span></span><br><span class="line"><span class="list">(<span class="keyword">setq</span> my-special-password <span class="list">(<span class="keyword">first</span> <span class="list">(<span class="keyword">second</span> data)</span>)</span>)</span></span><br></pre></td></tr></table></figure>
</div>

<p>
在代码块内部， <code>C-c M-b p</code> (<code>C-c C-v v</code>)扩展内容如下：
</p>
<div class="org-src-container">
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">let</span> <span class="list">(<span class="list">(<span class="keyword">data</span> <span class="quoted">(<span class="keyword">quote</span> ((<span class="string">"john-doe"</span>) (<span class="string">"abc123"</span>)))</span>)</span>)</span></span><br><span class="line"><span class="list">(<span class="keyword">setq</span> my-special-username <span class="list">(<span class="keyword">first</span> <span class="list">(<span class="keyword">first</span> data)</span>)</span>)</span></span><br><span class="line"><span class="list">(<span class="keyword">setq</span> my-special-password <span class="list">(<span class="keyword">first</span> <span class="list">(<span class="keyword">second</span> data)</span>)</span>)</span>)</span></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orgdc726a2" class="outline-3">
<h3 id="meta-programming-language"><a id="orgdc726a2"></a><a id="ID-db8adedd-db40-448a-ad61-700dc7fb7cff"></a><span class="section-number-3">5.7</span> <code>Org-mode</code> 的元编程语言</h3>
<div class="outline-text-3" id="text-meta-programming-language">
<p>
因为用一种语言编写的函数的返回值可以被传递给另一种语言编写的函数，
或者传递到本身就可程序化的 <code>Org-mode</code> 的表格中， 所以可将 <b>Babel</b> 用作元功能编程语言。
<b>Bable</b> 可使许多语言一起工作, 混合使用各语言，每种语言可用于最合适的任务。
</p>

<p>
例如，在shell中进行一些系统诊断，并用R图形化诊断结果.
</p>

<ol class="org-ol">
<li><p>
使用shell代码创建一个代码块，列出program目录中的目录以及它们的大小。Babel自动将输出转换为 <code>Org-mode</code> 表格。
</p>
<pre class="example">
#+name: directories
#+begin_src sh :results replace
  cd ~/program/ &amp;&amp; du -sc * | grep -v total
#+end_src

</pre>

<p>
代码如下：
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/program/ &amp;amp;&amp;amp; du -sc * | grep -v total</span><br></pre></td></tr></table></figure>
</div>

<p>
结果如下：
</p>
<pre class="example">
#+RESULTS: directories
|   2392 | github      |
|  90728 | org         |
|  15820 | program     |
| 190488 | program.tgz |

</pre></li>

<li><p>
一行R语言编写的函数将 <code>Org-mode</code> 表中的数据绘制为饼形图。 <del>请注意，当前代码块如何使用前一代码块的 <code>srcname</code> 来获取的数据</del> 。
</p>

<p>
在 <code>Org-mode</code> 文件中:
</p>
<pre class="example">
#+name: directory-pie-chart(dirs = directories)
#+begin_src R :session R-pie-example :file ../images/babel/dirs.png :var dirs=directories() :results graphics
  pie(dirs[,1], labels = dirs[,2])
#+end_src

</pre>
<blockquote>
<p>
注： <code>:results graphics</code> 请参阅 <a href="http://orgmode.org/worg/org-contrib/babel/languages/ob-doc-R.html#orgheadline7" rel="external nofollow noopener noreferrer" target="_blank">Org Mode Features for R Source Code Blocks</a>
</p>
</blockquote>

<p>
HTML 导出的代码:
</p>
<div class="org-src-container">
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">pie(dirs[,<span class="number">1</span>],labels=dirs[,<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
</div>


<div class="figure">
<p><img src="https://raw.githubusercontent.com/brantou/hexo-blog/master/source/images/babel/dirs.png" alt="dirs.png">
</p>
</div></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orga1de9ee" class="outline-2">
<h2 id="spreadsheet"><a id="orga1de9ee"></a><a id="ID-85379805-cddb-42bb-8bbf-21af4574b4b7"></a><span class="section-number-2">6</span> 在Org表格中使用代码块</h2>
<div class="outline-text-2" id="text-spreadsheet">
<p>
除了可将表格中的数据作为参数传递给代码块和结果存储为表格外， <b>Babel</b> 还有第三种方式使用 <code>Org-mode</code> 表格。
<code>Org-mode</code> <a href="http://orgmode.org/manual/The-spreadsheet.html#The-spreadsheet" rel="external nofollow noopener noreferrer" target="_blank">现有电子表格</a> 功能允许使用 <code>＃+TBLFM</code> 从指定单元格值自动计算出其他单元格值。
通过以上方式，表可使用<a href="http://orgmode.org/manual/Formula-syntax-for-Calc.html#Formula-syntax-for-Calc" rel="external nofollow noopener noreferrer" target="_blank">calc </a>和<a href="http://orgmode.org/manual/Formula-syntax-for-Lisp.html#Formula-syntax-for-Lisp" rel="external nofollow noopener noreferrer" target="_blank"> emacs lisp</a>来执行计算任务。
</p>

<p>
<b>Babel</b> 有效扩展了 <code>＃+TBLFM</code> 行使用代码块（以任何语言）进行必要计算的能力。
</p>
</div>

<div id="outline-container-org8858ce8" class="outline-3">
<h3 id="org8858ce8"><a id="ID-b2baa172-d9a5-4d81-a694-c4d92b67b0e6"></a><span class="section-number-3">6.1</span> 示例</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-orgc17fd81" class="outline-4">
<h4 id="orgc17fd81"><a id="ID-f37815fc-fabe-4906-a3d5-7cd6b812cb81"></a><span class="section-number-4">6.1.1</span> 示例 1: 使用R生成数据概要</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
将使用几个数字的平均值来填充 <code>Org-mode</code> 表中的一个单元格，来做简单示例。
首先，要生成数据, 以下代码块生成0和1之间的五个随机数来填充了 <code>Org-mode</code> 表。
</p>

<p>
在 <code>Org-mode</code> 文件中,如下所示:
</p>
<pre class="example">
#+name: tbl-example-data
#+begin_src R
runif(n=5, min=0, max=1)
#+end_src

</pre>

<p>
HTML 导出的代码如下:
</p>
<div class="org-src-container">
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">runif(n=<span class="number">5</span>, min=<span class="number">0</span>, max=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</div>

<p>
紧接着定义一个代码块计算来表列的平均值。
</p>

<p>
在 <code>Org-mode</code> 文件中,如下所示:
</p>
<pre class="example">
#+name: R-mean
#+begin_src R :var x=""
colMeans(x)
#+end_src

</pre>

<p>
HTML 导出的代码如下:
</p>
<div class="org-src-container">
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">colMeans(x)</span><br></pre></td></tr></table></figure>
</div>

<p>
最后，创建使用R代码的表。 通过使用 <code>org-sbe</code> （&rsquo;source block evaluate&rsquo;）宏来完成的代码块的调用。
</p>

<p>
在 <code>Org-mode</code> 文件中，表格调用代码块如下所示:
</p>
<pre class="example">
#+tblname: summaries
|              mean |
|-------------------|
| 0.779619386699051 |
#+TBLFM: @2$1='(org-sbe "R-mean" (x "tbl-example-data()"))

</pre>

<p>
HTML export of code:
</p>
<table id="org42c408b" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">mean</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0.58</td>
</tr>
</tbody>
</table>

<p>
重新计算表格公式，请在表格中使用 <code>C-u C-c C-c</code> 。 每次重新计算表格公式时，代码块都会再次计算，因此计算的平均值会发生变化。
</p>
</div>
</div>

<div id="outline-container-org3f7838f" class="outline-4">
<h4 id="org3f7838f"><a id="ID-e779ec57-c1f6-44dd-9a77-45497d7fa1ac"></a><span class="section-number-4">6.1.2</span> 示例 2: Babel 的测试套件</h4>
<div class="outline-text-4" id="text-6-1-2">
<blockquote>
<p>
While developing Babel, we used a suite of tests implemented as a large Org-mode table.
</p>
</blockquote>
<p>
在开发 <b>Babel</b> 时，开发者曾使用了一个居大的 <code>Org-mode</code> 表作为测试套件。
要运行测试套件，我们只需使用 <code>C-u C-c C-c</code> 对表进行计算：运行所有测试，将结果与期望进行比较，并使用结果和通过/失败的状态信息来更新表。
</p>

<p>
测试套件的简单版本如下.
</p>

<p>
在 <code>Org-mode</code> 文件中，如下所示:
</p>
<pre class="example">
#+TBLNAME: org-babel-tests
| functionality    | block        | arg |    expected |     results | pass |
|------------------+--------------+-----+-------------+-------------+------|
| basic evaluation |              |     |             |             | pass |
|------------------+--------------+-----+-------------+-------------+------|
| emacs lisp       | basic-elisp  |   2 |           4 |           4 | pass |
| shell            | basic-shell  |     |           6 |           6 | pass |
| ruby             | basic-ruby   |     |   org-babel |   org-babel | pass |
| python           | basic-python |     | hello world | hello world | pass |
| R                | basic-R      |     |          13 |          13 | pass |
#+TBLFM: $5='(if (= (length $3) 1) (org-sbe $2 (n $3)) (org-sbe $2)) :: $6='(if (string= $4 $5) "pass" (format "expected %S but was %S" $4 $5))

</pre>

<p>
HTML 导出的代码:
</p>
<table id="orgde930b5" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">

<col class="org-right">

<col class="org-left">

<col class="org-left">

<col class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">functionality</th>
<th scope="col" class="org-left">block</th>
<th scope="col" class="org-right">arg</th>
<th scope="col" class="org-left">expected</th>
<th scope="col" class="org-left">results</th>
<th scope="col" class="org-left">pass</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">basic evaluation</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">pass</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">emacs lisp</td>
<td class="org-left">basic-elisp</td>
<td class="org-right">2</td>
<td class="org-left">4</td>
<td class="org-left">4</td>
<td class="org-left">pass</td>
</tr>

<tr>
<td class="org-left">shell</td>
<td class="org-left">basic-shell</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">6</td>
<td class="org-left">6</td>
<td class="org-left">pass</td>
</tr>

<tr>
<td class="org-left">ruby</td>
<td class="org-left">basic-ruby</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">org-babel</td>
<td class="org-left">org-babel</td>
<td class="org-left">pass</td>
</tr>

<tr>
<td class="org-left">python</td>
<td class="org-left">basic-python</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">hello world</td>
<td class="org-left">hello world</td>
<td class="org-left">pass</td>
</tr>

<tr>
<td class="org-left">R</td>
<td class="org-left">basic-R</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">13</td>
<td class="org-left">13</td>
<td class="org-left">pass</td>
</tr>
</tbody>
</table>
</div>

<ol class="org-ol"><li><a id="orge56e9dd"></a><a id="ID-81e29d42-18c7-4545-b057-b77d97d2dc83"></a>用于测试的代码块<br><div class="outline-text-5" id="text-6-1-2-1">
<p>
<code>Org-mode</code> 文件中，如下所示：:
</p>
<pre class="example">
#+name: basic-elisp
#+begin_src emacs-lisp :var n=0
(* 2 n)
#+end_src

</pre>

<p>
HTML 导出代码，如下所示：:
</p>
<div class="org-src-container">
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">*</span> <span class="number">2</span> n)</span></span><br></pre></td></tr></table></figure>
</div>

<p>
<code>Org-mode</code> 文件中，如下所示：:
</p>
<pre class="example">
#+name: basic-shell
#+begin_src sh :results silent
expr 1 + 5
#+end_src

</pre>

<p>
HTML 导出代码，如下所示：:
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">expr <span class="number">1</span> + <span class="number">5</span></span><br></pre></td></tr></table></figure>
</div>

<p>
<code>Org-mode</code> 文件中，如下所示：:
</p>
<pre class="example">
#+name: date-simple
#+begin_src sh :results silent
date
#+end_src

</pre>

<p>
HTML 导出代码，如下所示：:
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">date</span><br></pre></td></tr></table></figure>
</div>

<p>
<code>Org-mode</code> 文件中，如下所示：:
</p>
<pre class="example">
#+name: basic-ruby
#+begin_src ruby :results silent
"org-babel"
#+end_src

</pre>

<p>
HTML 导出代码，如下所示：:
</p>
<div class="org-src-container">
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="string">"org-babel"</span></span><br></pre></td></tr></table></figure>
</div>

<p>
<code>Org-mode</code> 文件中，如下所示：
</p>
<pre class="example">
#+name: basic-python
#+begin_src python :results silent
"hello world"
#+end_src

</pre>

<p>
HTML 导出代码，如下所示：:
</p>
<div class="org-src-container">
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">"hello world"</span></span><br></pre></td></tr></table></figure>
</div>

<p>
<code>Org-mode</code> 文件中，如下所示：:
</p>
<pre class="example">
#+name: basic-R
#+begin_src R :results silent
b &lt;- 9
b + 4
#+end_src

</pre>

<p>
HTML 导出代码，如下所示：:
</p>
<div class="org-src-container">
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">b &amp;lt;- <span class="number">9</span></span><br><span class="line">b + <span class="number">4</span></span><br></pre></td></tr></table></figure>
</div>
</div></li></ol>
</div>
</div>
</div>

<div id="outline-container-org3b896b5" class="outline-2">
<h2 id="library-of-babel"><a id="org3b896b5"></a><a id="ID-1d60ae3e-72db-4ac5-a7e1-4a001d0fd930"></a><span class="section-number-2">7</span> Babel库文件</h2>
<div class="outline-text-2" id="text-library-of-babel">
<p>
(可参阅 <a href="http://orgmode.org/manual/Library-of-Babel.html#Library-of-Babel" rel="external nofollow noopener noreferrer" target="_blank">Org manual:Library-of-Babel</a>)
</p>

<p>
正如上面的 <a href="#using-a-code-block-as-a-function">square</a> 示例中看到的，一旦代码块被定义，可使用 <code>lob</code> 符号反复调用:
</p>

<pre class="example">
#+lob: square(x=6)

</pre>

<p>
但是，若是需要为每个 <code>Org-mode</code> 缓冲区提供的通用,可重用的代码块呢？
</p>

<p>
除了当前的缓冲区外， <b>Babel</b> 还会搜索 *Babel*库文件中预先定义的代码块。
这是一个用户可扩展的现成的代码块集合，用于处理常见任务。
对于 <b>Bable</b> 库（尚未完成！）的一个可能的用途就是是使用R，gnuplot，asymptote等语言为 <code>Org-mode</code> 表中保存的数据提供绘图功能。
如果你定义的某些代码块 对其他 <code>Org-mode</code> 用户也非常有用，可考虑将其添加到 <b>Babel</b> 库中;
类似的，可以随时求助，*Babel* 可引用外部代码来解决问题 &#x2013; 其他Babel用户也有机会提供一些有用的代码。
</p>

<p>
Babel预先填充(即把库中的代码块加载到缓冲区中)位于<a href="http://orgmode.org/worg/org-contrib/babel/library-of-babel.html" rel="external nofollow noopener noreferrer" target="_blank"> Babel库文件</a> 中的代码块 - <a href="http://orgmode.org/w/org-mode.git/blob/HEAD:/doc/library-of-babel.org" rel="external nofollow noopener noreferrer" target="_blank">library-of-babel.org</a> 上的原始文件。
可使用 <code>org-babel-lob-ingest</code> （绑定到 <code>C-c C-v i</code> ）从任何 <code>Org-mode</code> 文件中向库添加代码块。
</p>

<div class="org-src-container">
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">org-babel-lob-ingest</span> <span class="string">"path/to/file.org"</span>)</span></span><br></pre></td></tr></table></figure>
</div>

<p>
注： 可以将表值或源代码块的输出传递给 <b>Babel</b> 库函数。 还可以在代码块的参数中引用 <b>Babel</b> 函数库函数。
</p>
</div>
</div>

<div id="outline-container-org9721e29" class="outline-2">
<h2 id="literate-programming"><a id="org9721e29"></a><a id="ID-c327d292-1a89-4e27-9e42-81b63059e2bb"></a><span class="section-number-2">8</span> 文学化编程</h2>
<div class="outline-text-2" id="text-literate-programming">
<blockquote>
<p>
Let us change our traditional attitude to the construction of
programs: Instead of imagining that our main task is to instruct a
<i>computer</i> what to do, let us concentrate rather on explaining to
<i>human beings</i> what we want a computer to do.
</p>

<p>
让我们改改传统上构建程序的态度：不要认为程序的主要任务是指导计算机怎么做，相反，程序要致力于向人们解释，它想让计算机做什么。<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup>
</p>

<p>
The practitioner of literate programming can be regarded as an
essayist, whose main concern is with exposition and excellence of
style. Such an author, with thesaurus in hand, chooses the names of
variables carefully and explains what each variable means. He or she
strives for a program that is comprehensible because its concepts have
been introduced in an order that is best for human understanding,
using a mixture of formal and informal methods that reinforce each
other.
</p>

<p>
文学编程人士可被视为作家，他们首要考虑的任务是如何清楚地阐述、如何形成优秀的风格。
这样的作者胸有成竹，会仔细地挑选变量名，并给予解释。为力求程序之可读，
他/她使用形式和非形式互补的混合手法，将各种概念按照人们能理解的方式顺序编排下来。<sup><a id="fnr.3.100" class="footref" href="#fn.3">3</a></sup>
&#x2013; Donald Knuth
</p>
</blockquote>

<p>
Babel支持 <a href="https://zh.wikipedia.org/wiki/%E6%96%87%E5%AD%A6%E7%BC%96%E7%A8%8B" rel="external nofollow noopener noreferrer" target="_blank">文学编程</a> （LP），允许编程行为发生在 <code>Org-mode</code> 文档中。
然后可将 <code>Org-mode</code> 文件导出（用LP语言编写）到HTML或LaTeX等更可视化的文本格式中以供人类查阅和使用，
并且可以将嵌入的源代码（ <b>tangle</b> in LP speak）转换成源代码文件以供计算机执行。
</p>

<p>
为了支持这些操作， <b>Babel</b> 依赖于 <code>Org-mode</code> 的 <a href="http://orgmode.org/manual/Exporting.html#Exporting" rel="external nofollow noopener noreferrer" target="_blank">文档的导出功能</a> 来编排文档，
依赖于使用 <a href="http://www.cs.tufts.edu/~nr/noweb/" rel="external nofollow noopener noreferrer" target="_blank">Noweb reference syntax</a> <b>tangling</b> 代码文件的 <code>org-babel-tangle</code> （ <code>C-c C-v t</code> ）  函数。
</p>

<p>
以下示例演示了在 <b>Babel</b> 中 <b>tangling</b> 的过程。
</p>
</div>

<div id="outline-container-org94c8cb3" class="outline-3">
<h3 id="org94c8cb3"><a id="ID-9e3da4eb-99b2-46f7-b47a-903fbb40b47a"></a><span class="section-number-3">8.1</span> <i>tangling</i> 的示例</h3>
<div class="outline-text-3" id="text-8-1">
</div>
<div id="outline-container-org9553986" class="outline-4">
<h4 id="literate-programming-example"><a id="org9553986"></a><a id="ID-b2c57a71-abe0-402e-a475-3999f8d0f04e"></a><span class="section-number-4">8.1.1</span> 简单文学编程示例 (Noweb syntax)</h4>
<div class="outline-text-4" id="text-literate-programming-example">
<blockquote>
<p>
Tangling functionality is controlled by the <code>tangle</code> family of tangle
header arguments.  These arguments can be used to turn tangling on or
off (the default), either for the code block or the Org-mode heading level.
</p>
</blockquote>

<p>
以下代码块演示如何使用 <code>org-babel-tangle</code> （ <code>C-c C-v t</code> ） 把分散的代码块 <i>tangle</i> 为单个源代码文件。
</p>

<p>
以下两个代码块没有 <code>tangle</code> 头参数，因此不会创建源代码文件。 它们通过第三个代码块被包含在源代码文件中，该代码块具有 <code>tangle</code> 头参数。
</p>

<p>
<code>Org-mode</code> 文件中，如下所示：:
</p>
<pre class="example">
#+name: hello-world-prefix
#+begin_src sh :exports none
  echo "/-----------------------------------------------------------\\"
#+end_src

</pre>

<p>
<code>Org-mode</code> 文件中，如下所示：
</p>
<pre class="example">
#+name: hello-world-postfix
#+begin_src sh :exports none
  echo "\-----------------------------------------------------------/"
#+end_src

</pre>

<p>
第三个代码块具有 <code>tangle</code> 头参数，指出将被写入的源代码的文件的名称。
它还包含了前面两个代码块的Noweb样式引用。 这些引用将在 <i>tangling</i> 期间扩展，以使它们包含在输出文件中。
</p>

<p>
<code>Org-mode</code> 文件中，如下所示：:
</p>
<pre class="example">
#+name: hello-world
#+begin_src sh :tangle hello.sh :exports none :noweb yes
  &lt;&lt;hello-world-prefix&gt;&gt;
  echo "|                       hello world                         |"
  &lt;&lt;hello-world-postfix&gt;&gt;
#+end_src

</pre>

<p>
调用函数 <code>org-babel-tangle</code> （ <code>C-c C-v t</code> ）将shell源码写到 <code>hello.sh</code> 文件中：
</p>

<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="shebang">#!/usr/bin/env sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/-----------------------------------------------------------\\"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"|                       hello world                         |"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"\-----------------------------------------------------------/"</span></span><br></pre></td></tr></table></figure>
</div>

<p>
此外，可以使用以下语法来插入代码块执行的结果，在下面情况下是名为 <code>example-block</code> 的代码块的执行结果。
</p>

<p>
#&lt;&lt; example-block() &gt;&gt;
</p>

<p>
任何可选参数都可以传递给 <code>example-block()</code> ，方法是将参数放入括号内，并遵循调用代码块函数定义的约定（参见 <a href="http://orgmode.org/worg/org-contrib/babel/intro.html#library-of-babel" rel="external nofollow noopener noreferrer" target="_blank">babel库</a>）。 如下:
</p>

<p>
#&lt;&lt; example-block(a=9) &gt;&gt;
</p>

<p>
参数 “a” 的值设置为等于 “9”。 请注意，这些参数不在当前源代码块中执行，而是按字面顺序传递给 <code>example-block()</code> 。
</p>
</div>
</div>

<div id="outline-container-orge00d699" class="outline-4">
<h4 id="emacs-initialization"><a id="orge00d699"></a><a id="ID-d338dd50-4694-45d7-a74d-09355b195235"></a><span class="section-number-4">8.1.2</span> 用Bable初始化Emacs</h4>
<div class="outline-text-4" id="text-emacs-initialization">

<div class="figure">
<p><img src="http://orgmode.org/worg/images/babel/dot-emacs.png" alt="dot-emacs.png">
</p>
</div>

<p>
<b>Babel</b>  对于将Emacs初始化信息嵌入 <code>Org-mode</code> 文件中有特别的支持。
<code>org-babel-load-file</code> 函数可用于加载嵌入在 <code>Org-mode</code> 文件中的Emacs Lisp代码块，方法与加载常规Emacs Lisp文件（如.emacs）相同。
</p>

<p>
这就允许利用Org-mode的功能特性，例如折叠，标签，笔记，HTML导出等，来组织和维护Emacs初始化配置。
</p>

<p>
要想了解这一点，可以参考简单的<a href="#literate-emacs-init">优雅的Emacs初始化</a>示例，或者查看 <a href="http://github.com/eschulte/emacs-starter-kit/tree/master" rel="external nofollow noopener noreferrer" target="_blank">Org-babel-emacs-starter-kit </a>中提供的 <i>Phil Hagelberg</i> 的优秀 <a href="http://github.com/technomancy/emacs-starter-kit/tree/master" rel="external nofollow noopener noreferrer" target="_blank">emacs-starter-kit</a> 的 <i>Babel Literate Programming</i> 版本。
To try this out, either see the simple Literate Emacs Initialization
example, or check out the Babel Literate Programming version of
Phil Hagelberg&rsquo;s excellent emacs-starter-kit available at
Org-babel-emacs-starter-kit.
</p>
</div>

<ol class="org-ol"><li><a id="literate-emacs-init"></a><a id="orgf03f1d8"></a><a id="ID-d757b79f-8afa-4a19-a6bc-5267fa6f886c"></a>优雅的Emacs初始化<br><div class="outline-text-5" id="text-literate-emacs-init">
<p>
请按照以下5个步骤进行操作：
</p>
<ol class="org-ol">
<li><p>
在主目录的内创建一个名为 <code>.emacs.d</code> 的目录;
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mkdir ~/.emacs.d</span><br></pre></td></tr></table></figure>
</div></li>
<li><p>
<i>checkout</i> 最新版本的 <code>Org-mode</code> 到这个新目录的src子目录中;
of this new directory;
</p>
<div class="org-src-container">
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.emacs.d</span><br><span class="line">mkdir src</span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">git <span class="built_in">clone</span> git://orgmode.org/org-mode.git</span><br></pre></td></tr></table></figure>
</div></li>
<li><p>
将以下代码块放入Emacs初始化目录（ <code>~/.emacs.d</code> ）下名为 <code>init.el</code> 的文件中。
</p>
<div class="org-src-container">
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line"><span class="comment">;;; init.el --- Where all the magic begins</span></span><br><span class="line"><span class="comment">;;</span></span><br><span class="line"><span class="comment">;; This file loads Org-mode and then loads the rest of our Emacs initialization from Emacs lisp</span></span><br><span class="line"><span class="comment">;; embedded in literate Org-mode files.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; Load up Org Mode and (now included) Org Babel for elisp embedded in Org Mode files</span></span><br><span class="line"><span class="list">(<span class="keyword">setq</span> dotfiles-dir <span class="list">(<span class="keyword">file-name-directory</span> <span class="list">(<span class="keyword">or</span> <span class="list">(<span class="keyword">buffer-file-name</span>)</span> load-file-name)</span>)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="list">(<span class="keyword">let*</span> <span class="list">(<span class="list">(<span class="keyword">org-dir</span> <span class="list">(<span class="keyword">expand-file-name</span></span><br><span class="line">                 <span class="string">"lisp"</span> <span class="list">(<span class="keyword">expand-file-name</span></span><br><span class="line">                         <span class="string">"org"</span> <span class="list">(<span class="keyword">expand-file-name</span></span><br><span class="line">                                <span class="string">"src"</span> dotfiles-dir)</span>)</span>)</span>)</span></span><br><span class="line">       <span class="list">(<span class="keyword">org-contrib-dir</span> <span class="list">(<span class="keyword">expand-file-name</span></span><br><span class="line">                         <span class="string">"lisp"</span> <span class="list">(<span class="keyword">expand-file-name</span></span><br><span class="line">                                 <span class="string">"contrib"</span> <span class="list">(<span class="keyword">expand-file-name</span></span><br><span class="line">                                            <span class="string">".."</span> org-dir)</span>)</span>)</span>)</span></span><br><span class="line">       <span class="list">(<span class="keyword">load-path</span> <span class="list">(<span class="keyword">append</span> <span class="list">(<span class="keyword">list</span> org-dir org-contrib-dir)</span></span><br><span class="line">                          <span class="list">(<span class="keyword">or</span> load-path <span class="literal">nil</span>)</span>)</span>)</span>)</span></span><br><span class="line">  <span class="comment">;; load up Org-mode and Org-babel</span></span><br><span class="line">  <span class="list">(<span class="keyword">require</span> <span class="quoted">'org-install</span>)</span></span><br><span class="line">  <span class="list">(<span class="keyword">require</span> <span class="quoted">'ob-tangle</span>)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; load up all literate org-mode files in this directory</span></span><br><span class="line"><span class="list">(<span class="keyword">mapc</span> <span class="quoted">#'org-babel-load-file</span> <span class="list">(<span class="keyword">directory-files</span> dotfiles-dir <span class="literal">t</span> <span class="string">"\\.org$"</span>)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;;; init.el ends here</span></span><br></pre></td></tr></table></figure>
</div></li>
<li>在Emacs Lisp代码块中实现所有Emacs定制，嵌入在该目录中的 <code>Org-mode</code> 文件中; 和</li>
<li>重启Emacs读取自定义配置。</li>
</ol>
</div></li></ol>
</div>
</div>
</div>

<div id="outline-container-org3b5dc76" class="outline-2">
<h2 id="reproducable-research"><a id="org3b5dc76"></a><a id="ID-0b64ef01-c4c4-405d-8ed3-23dc6384d825"></a><span class="section-number-2">9</span> 可重复性研究</h2>
<div class="outline-text-2" id="text-reproducable-research">
<blockquote>
<p>
An article about computational science in a scientific publication is
not the scholarship itself, it is merely advertising of the
scholarship. The actual scholarship is the complete software
development environment and the complete set of instructions which
generated the figures.
</p>

<p>
&#x2013; D. Donoho
</p>
</blockquote>

<p>
<a href="http://reproducibleresearch.net/" rel="external nofollow noopener noreferrer" target="_blank">可重复性研究</a> （RR）是与科研出版物一起分发的所有数据，软件源代码和重现出版物中讨论的结果所需的工具的方法。
因此，RR包不仅描述了研究及其结果，而且成为可以复制和扩展研究的完整实验室。
</p>

<p>
<code>Org-mode</code> 已经很好的支持<a href="http://orgmode.org/manual/Exporting.html#Exporting" rel="external nofollow noopener noreferrer" target="_blank">导出到HTML和LaTeX</a>。
<b>Babel</b> 通过激活嵌入在 <code>Org-mode</code> 文档中的数据和代码块，使组织模式成为RR的工具; 整个文档变得可执行。
这使得鼓励读者重新创建结果并实验自己的思路来分发科研成果成为可能。
</p>

<p>
<a href="http://en.wikipedia.org/wiki/Sweave" rel="external nofollow noopener noreferrer" target="_blank">Sweave</a> 是目前比较知名的RR工具，它提供了将R代码嵌入到LaTeX文档中的机制。
Sweave是一个成熟而且非常有用的工具，但我们认为 <b>Babel</b> 有几个优点:
</p>
<ul class="org-ul">
<li>支持多种语言</li>
<li>导出过程灵活强大，除了LaTeX之外，还包括HTML作为目标格式; 和</li>
<li>文档可利用 <code>Org-mode</code>  强大的功能特性，支持项目规划和任务管理等。</li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
Calling <code>C-c C-o</code> on a code block will open the block&rsquo;s results in a separate buffer.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
This mode will be familiar to Sweave users.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
摘自<a href="http://www.cnblogs.com/ajian005/archive/2012/10/25/2753910.html" rel="external nofollow noopener noreferrer" target="_blank">文艺编程 Literate Programming （原文中英文对照）</a>, 个人更喜欢文学编程。
</p></div></div>


</div>
</div>
Last Updated 2017-07-10 Mon 11:46.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" rel="external nofollow noopener noreferrer" target="_blank">hexo-renderer-org</a> with <a href="http://www.gnu.org/software/emacs/" rel="external nofollow noopener noreferrer" target="_blank">Emacs</a> 24.5.1 (<a href="http://orgmode.org" rel="external nofollow noopener noreferrer" target="_blank">Org</a> mode 9.0.6)

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/tutorial/" rel="tag"># tutorial</a>
          
            <a href="/tags/org-mode/" rel="tag"># org-mode</a>
          
            <a href="/tags/babel/" rel="tag"># babel</a>
          
            <a href="/tags/active-code/" rel="tag"># active-code</a>
          
            <a href="/tags/literate-programming/" rel="tag"># literate-programming</a>
          
            <a href="/tags/元编程/" rel="tag"># 元编程</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/21/just-try/" rel="next" title="Org-mode手册">
                <i class="fa fa-chevron-left"></i> Org-mode手册
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/04/06/org-spreadsheet-intro/" rel="prev" title="Org-mode的电子表格的简明教程">
                Org-mode的电子表格的简明教程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

      
      
      
        <h3 class="article-title" style="font-size: 20px;">相关文章</h3>
        <ul class="related-posts">
        
            <li class="related-posts-item"><a href="https://brantou.github.io//2017/06/12/go-source-code-block-in-org/">在Org-mode中执行Go代码</a></li>
        
            <li class="related-posts-item"><a href="https://brantou.github.io//2017/04/14/org-column-view-tutorial/">Org-mode的列视图简明教程</a></li>
        
            <li class="related-posts-item"><a href="https://brantou.github.io//2017/04/09/org-lookups/">Org-mode表查找功能的简明教程</a></li>
        
            <li class="related-posts-item"><a href="https://brantou.github.io//2017/04/06/org-spreadsheet-intro/">Org-mode的电子表格的简明教程</a></li>
        
            <li class="related-posts-item"><a href="https://brantou.github.io//2017/03/21/go-logrus/">Go的日志库logrus试用</a></li>
        
        </ul>
      
      

    </footer>
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="hypercomments_widget"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="https://avatars1.githubusercontent.com/u/26197076?v=3&s=400" alt="Brantou">
          <p class="site-author-name" itemprop="name">Brantou</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">34</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/brantou" target="_blank" title="GitHub" rel="external nofollow noopener noreferrer">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/brantou89" target="_blank" title="Twitter" rel="external nofollow noopener noreferrer">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#introduction"><span class="nav-text">1 序言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#org59d9014"><span class="nav-text">2 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#getting-started"><span class="nav-text">3 初始配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#source-code-blocks"><span class="nav-text">4 代码块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#source-code-blocks-org"><span class="nav-text">4.1 代码块在 Org-mode 中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#source-code-blocks-babel"><span class="nav-text">4.2 代码块在 Babel 中</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#source-code-execution"><span class="nav-text">5 源代码执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#orgc67246c"><span class="nav-text">5.1 示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#org9ec4272"><span class="nav-text">5.1.1 Ruby</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org7d933f1"><span class="nav-text">5.1.2 Shell</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org65b8c1f"><span class="nav-text">5.1.3 R</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org28e2dc0"><span class="nav-text">5.1.4 ditaa</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org4d050cb"><span class="nav-text">5.1.5 js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#results"><span class="nav-text">5.2 捕获代码执行结果</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#results-value"><span class="nav-text">5.2.1 :results value (functional mode)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#results-output"><span class="nav-text">5.2.2 :results output (scripting mode)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orgb59e5f1"><span class="nav-text">5.3 基于会话的代码块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arguments-to-source-code-blocks"><span class="nav-text">5.4 代码块的入参</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#using-a-code-block-as-a-function"><span class="nav-text">5.4.1 代码块作为函数的简单示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org4806d45"><span class="nav-text">5.4.2 Org-mode 表格作为入参的更复杂的示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org1c8ca5a"><span class="nav-text">5.5 内联(In-line)的代码块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org6a9bbfa"><span class="nav-text">5.6 代码块扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#meta-programming-language"><span class="nav-text">5.7 Org-mode 的元编程语言</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spreadsheet"><span class="nav-text">6 在Org表格中使用代码块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#org8858ce8"><span class="nav-text">6.1 示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#orgc17fd81"><span class="nav-text">6.1.1 示例 1: 使用R生成数据概要</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org3f7838f"><span class="nav-text">6.1.2 示例 2: Babel 的测试套件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#library-of-babel"><span class="nav-text">7 Babel库文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#literate-programming"><span class="nav-text">8 文学化编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#org94c8cb3"><span class="nav-text">8.1 tangling 的示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#literate-programming-example"><span class="nav-text">8.1.1 简单文学编程示例 (Noweb syntax)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#emacs-initialization"><span class="nav-text">8.1.2 用Bable初始化Emacs</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reproducable-research"><span class="nav-text">9 可重复性研究</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-text">Footnotes: </span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Brantou</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow noopener noreferrer" target="_blank">
    NexT.Pisces
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	

		<script type="text/javascript">
		_hcwp = window._hcwp || [];

		_hcwp.push({widget:"Bloggerstream", widget_id: 89947, selector:".hc-comment-count", label: "{\%COUNT%\}" });

		
		_hcwp.push({widget:"Stream", widget_id: 89947, xid: "2017/04/01/babel-intro/"});
		

		(function() {
		if("HC_LOAD_INIT" in window)return;
		HC_LOAD_INIT = true;
		var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();
		var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
		hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/89947/"+lang+"/widget.js";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hcc, s.nextSibling);
		})();
		</script>

	












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

</body>
</html>
